<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
  <head>
    <title>DC - Внешние архиваторы</title>
    <link rel="stylesheet" type="text/css" href="doublecmd.css">
    <link rel="shortcut icon" href="../../pixmaps/common/favicon.ico">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  </head>

  <body>
    <a name="topofpage"></a>
    <div class="header"><a href="index.html"><img src="../../pixmaps/common/dclogo2017.png" alt="Double Commander" height="48" width="374"></a>
      <div id="global-nav" class="nav"><a title="Домашняя страница Double Commander" href="https://doublecmd.sourceforge.io/" target="_blank">Домашняя страница</a> | <a title="Вики Double Commander" href="https://github.com/doublecmd/doublecmd/wiki" target="_blank">Вики</a></div>
    </div>
    <div class="footer"><div class="nav"><a title="Начало" href="index.html">Начало</a> | <a title="Предыдущая страница" href="directoryhotlist.html">Пред.</a> | <a title="Следующая страница" href="toolbar.html">След.</a></div></div>

    <div class="dchelpage">
      <div>
        <h1>2.10. Внешние архиваторы</h1>
      </div>

      <div>
        <h2>Содержание</h2>
        <dl>
          <dt>1. <a href="#workingcomp">Работа со сжатыми файлами</a></dt>
          <dt>2. <a href="#resources">Средства для работы со сжатыми файлами</a></dt>
          <dt>3. <a href="#withplugin">Работа с плагинами</a></dt>
          <dt>4. <a href="#archivers">Работа с внешними архиваторами</a></dt>
          <dt>5. <a href="#config">Настройка интеграции внешних архиваторов</a></dt>
          <dd>
            <dl>
              <dt>5.1. <a href="#addingnew">Добавление нового внешнего архиватора</a></dt>
              <dt>5.2. <a href="#variables">Переменные для команд внешнего архиватора</a></dt>
              <dt>5.3. <a href="#modifiers">Модификаторы переменных</a></dt>
              <dt>5.4. <a href="#actionlist">Настройка действия "Список"</a></dt>
              <dt>5.5. <a href="#recuperate">Получение списка содержимого</a></dt>
              <dd>
                <dl>
                  <dt>5.5.1. <a href="#delimit">Разграничение области для анализа</a></dt>
                  <dt>5.5.2. <a href="#parsing">Разбор списка содержимого</a></dt>
                  <dt>5.5.3. <a href="#standardparsing">Стандартный синтаксис разбора вывода</a></dt>
                  <dt>5.5.4. <a href="#standardexample">Пример со стандартным синтаксисом</a></dt>
                  <dt>5.5.5. <a href="#advancedparsing">Расширенный синтаксис разбора вывода</a></dt>
                  <dt>5.5.6. <a href="#advancedexample">Пример с расширенным синтаксисом</a></dt>
                </dl>
              </dd>
              <dt>5.6. <a href="#actionextract">Настройка действия "Извлечь"</a></dt>
              <dt>5.7. <a href="#actionadding">Настройка действия "Добавить"</a></dt>
              <dt>5.8. <a href="#actiondelete">Настройка действия "Удалить"</a></dt>
              <dt>5.9. <a href="#actiontest">Настройка действия "Проверить"</a></dt>
              <dt>5.10. <a href="#actionextractnpath">Настройка действия "Распаковать не учитывая пути"</a></dt>
              <dt>5.11. <a href="#actionselfextract">Настройка действия "Создать самораспаковывающийся архив"</a></dt>
              <dt>5.12. <a href="#configids">Использование ID</a></dt>
            </dl>
          </dd>
        </dl>
      </div>

      <div>
        <h2><a name="workingcomp">1. Работа со сжатыми файлами</a></h2>
        <p>После должной настройки Double Commander сможет работать со сжатыми файлами, как если бы это были простые папки.</p>
        <p>Например, если у нас в панели есть ZIP-файл, мы можем просто выделить его, нажать <kbd>Enter</kbd> и в панели будет показано содержимое этого файла так же, как если бы мы перешли в каталог.</p>
        <p>"Внутри" сжатого файла мы можем выполнять некоторые минимальные базовые функции, такие как просмотр файла, копирование его в другую панель и некоторые другие.</p>
        <p>На изображении ниже показан пример открытия сжатого файла "help.rar":</p>
        <p class="figure"><img class="largeimage" title="Обзор" alt="Обзор" src="images/imgDC/archiveimg1.png" width="768" height="454"></p>
        <p class="navback"><a href="#topofpage">(наверх)</a></p>
      </div>

      <div>
        <h2><a name="resources">2. Средства для работы со сжатыми файлами</a></h2>
        <p>Double Commander достаточно универсален, чтобы через собственный интерфейс использовать внешние программы для работы со сжатыми файлами.</p>
        <p>Он использует два разных принципа:</p>
        <ul>
          <li>С помощью плагинов</li>
          <li>Читая и разбирая вывод командной строки внешнего архиватора</li>
        </ul>
        <p class="navback"><a href="#topofpage">(наверх)</a></p>
      </div>

      <div>
        <h2><a name="withplugin">3. Работа с плагинами</a></h2>
        <p>Мы можем настроить Double Commander на использование "архиваторных плагинов", которые помогут справиться со сжатым файлом.</p>
        <p>Дистрибутив Double Commander уже включает в себя некоторые из подобных WCX-плагинов.</p>
        <p>На момент написания этих строк имеем следующий список (перечислены типы архивов, которые уже добавлены в настройки):</p>
        <table>
          <tr class="rowcategorytitle"><th colspan="2">Архиваторные (WCX) плагины в дистрибутиве</th></tr>
          <tr class="rowsubtitle"><th class="namecolumn">Имя плагина</th><th class="categorydesccolumn">Поддерживаемые архивы</th></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">cpio.wcx<sup>*</sup></div></td><td class="hintcell">*.cpio</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">deb.wcx<sup>*</sup></div></td><td class="hintcell">*.deb</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">rpm.wcx</div></td><td class="hintcell">*.rpm</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">sevenzip.wcx<sup>**</sup></div></td><td class="hintcell">*.7z, *.arj, *.cab, *.cpio, *.cramfs, *.deb, *.dmg, *.fat, *.hfs, *.iso, *.lha, *.lzh, *.ntfs, *.squashfs, *.taz, *.vhd, *.wim, *.xar и *.z</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">unrar.wcx</div></td><td class="hintcell">*.rar</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">zip.wcx</div></td><td class="hintcell">*.bz2, *.gz, *.jar, *.lzma, *.tar, *.tbz, *.tgz, *.tlz, *.txz, *.xz, *.zip, *.zipx и *.zst</td></tr>
          <tr><td class="hintcell" colspan="2">* только Unix/Linux; ** только Windows</td></tr>
        </table>
        <p><i>Пожалуйста, имейте в виду, что для ряда форматов поддерживается только чтение, то есть доступны только просмотр содержимого, распаковка и тестирование.</i></p>
        <br>

        <p>Кроме того, в Интернете мы можем найти ряд других WCX-плагинов.</p>
        <p>Также помните, что плагины, написанные для работы с Total Commander, должны работать и с Double Commander.</p>
        <br>

        <p>Чтобы установить, включить или настроить их, нам нужно зайти в Настройки&nbsp;&gt; Параметры...&nbsp;&gt; Плагины&nbsp;&gt; Плагины WCX:</p>
        <p class="figure"><img class="largeimage" title="Обзор" alt="Обзор" src="images/imgDC/archiveimg2.png" width="694" height="380"></p>
        <p class="navback"><a href="#topofpage">(наверх)</a></p>
      </div>

      <div>
        <h2><a name="archivers">4. Работа с внешними архиваторами</a></h2>
        <p>Иногда нужного плагина просто не существует.</p>
        <p>Или по какой-то причине, такое иногда может случиться, мы хотим явно использовать внешний архиватор в силу функционального преимущества или чего-то, что не умеет обычный архиваторный плагин.</p>
        <p>Double Commander использует механизм работы с внешними архиваторами аналогичный плагину <a href="http://wcx.sourceforge.net/" target="_blank">MultiArc</a> для Total Commander.</p>
        <p>Чтобы было понятнее, <b>использование внешнего архиватора можно описать следующим образом: это способ запустить архиватор, но заставить Double Commander управлять им, передавая исполняемому файлу архиватора различные параметры, которые нам понадобятся для интеграции с приложением</b>.</p>
        <p>Оставшаяся часть этой страницы будет посвящена вопросу настройки Double Commander для использования внешнего архиватора.</p>
        <p>Предположим, мы хотим использовать "rar.exe" для работы с архивами RAR.</p>
        <p>Как можно догадаться, <b>необходимо настроить вызов внешнего архиватора для того, чтобы мы могли...</b></p>
        <ul>
          <li>получить список содержимого файла архива</li>
          <li>распаковать архив</li>
          <li>добавить один файл или список файлов в существующий архив или создать новый</li>
          <li>извлечь из архива один файл или список файлов</li>
        </ul>
        <br>

        <p>Все эти действия будут сконфигурированы в окне настроек DC в разделе "Архиваторы":</p>
        <p class="figure"><img class="largeimage" title="Обзор" alt="Обзор" src="images/imgDC/archiveimg3.png" width="854" height="571"></p>

        <p>Давайте рассмотрим универсальные возможности, предлагаемые нам Double Commander для использования внешнего упаковщика.</p>
        <p class="navback"><a href="#topofpage">(наверх)</a></p>
      </div>

      <div>
        <h2><a name="config">5. Настройка интеграции внешних архиваторов</a></h2>
        <p>Мы не будем описывать здесь, в начале, каждое поле, вместо этого подробно, шаг за шагом, разберём пример интеграции внешнего архиватора "rar.exe".</p>
        <p class="navback"><a href="#topofpage">(наверх)</a></p>
      </div>

      <div>
        <h2><a name="addingnew">5.1. Добавление нового внешнего архиватора</a></h2>
        <p>Нажимаем кнопку "Добавить", указываем имя архиватора и теперь мы готовы его настроить.</p>
        <p class="figure"><img class="largeimage" title="Обзор" alt="Обзор" src="images/imgDC/archiveimg4.png" width="606" height="410"></p>
        <br>
        <p>Далее нам нужно добавить описание архиватора, путь к исполняемому файлу, а затем расширение файла, без точки.</p>
        <p>Если у нас более одного возможного расширения, просто перечисляем их через запятую, без пробела.</p>
        <p class="figure"><img class="largeimage" title="Обзор" alt="Обзор" src="images/imgDC/archiveimg5.png" width="704" height="211"></p>
        <p>Примечание: Double Commander поддерживает двойные расширения (например, "tar.gz", "tar.xz" и так далее), они должны размещаться в начале списка расширений (то есть "tar.gz" до "gz").</p>
        <p class="navback"><a href="#topofpage">(наверх)</a></p>
      </div>

      <div>
        <h2><a name="variables">5.2. Переменные для команд внешнего архиватора</a></h2>
        <p>Как упоминалось ранее, нам нужно настроить вызов исполняемого файла внешнего архиватора для необходимых нам действий.</p>
        <p>Чтобы помочь в этом, Double Commander предлагает нам ряд переменных, ниже представлена таблица доступных:</p>
        <table>
          <tr class="rowcategorytitle"><th colspan="2">Определение команды</th></tr>
          <tr class="rowsubtitle"><th class="namecolumn">Переменная</th><th class="categorydesccolumn">Что означает</th></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">%P</div></td><td class="hintcell">Длинное имя архиватора (как в поле "Архиватор")</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">%p</div></td><td class="hintcell">Короткое имя архиватора (как в поле "Архиватор")</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">%A</div></td><td class="hintcell">Длинное имя файла архива</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">%a</div></td><td class="hintcell">Короткое имя файла архива</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">%L</div></td><td class="hintcell">Список файлов.<br>Это файл, содержащий имена файлов, которые будут обрабатываться внешним архиватором.<br>Имена файлов длинные.</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">%l</div></td><td class="hintcell">Список файлов с короткими именами файлов</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">%F</div></td><td class="hintcell">Имя одного файла для обработки.<br>Архиватор будет вызван несколько раз, до тех пор, пока не будут обработаны все файлы.<br>Эта переменная должна использоваться только в том случае, если архиватор не поддерживает работу со списком файлов в командной строке.</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">%V</div></td><td class="hintcell">Размер тома (для многотомного архива)</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">%W</div></td><td class="hintcell">Пароль</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">%E&lt;errorlevel&gt;</div></td><td class="hintcell">Максимальный допустимый код завершения (errorlevel, код выхода).<br>Например, %E2 означает, что принимаются коды завершения 0, 1 и 2.<br>Эта переменная может быть указана в любом месте команды.<br>Если она не используется, то только код завершения 0 считается успешным.</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">%O&lt;модификатор&gt;</div></td><td class="hintcell">По умолчанию MultiArc конвертирует вывод архиватора из кодировки OEM (DOS) в UTF-8.<br>Используйте её для переопределения кодировки, возможные модификаторы смотрите ниже.<br>Может использоваться только с командой "Список".</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">%R</div></td><td class="hintcell">Целевая поддиректория В архиве</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">{}</div></td><td class="hintcell">Если какая-то переменная заключена в фигурные скобки, то она будет добавлена только если эта переменная содержит что-либо, т.е. не пустая</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">%S</div></td><td class="hintcell">Зависит от режима, устанавливается в диалоге настройки, MultiArc будет запрашивать у пользователя дополнительные параметры командной строки, которые должны быть размещены на месте %S</td></tr>
        </table>
        <p>Не беспокойтесь, ниже мы покажем пример для лучшего понимания.</p>
        <p class="navback"><a href="#topofpage">(наверх)</a></p>
      </div>

      <div>
        <h2><a name="modifiers">5.3. Модификаторы переменных</a></h2>
        <p>Эти модификаторы могут быть указаны сразу же после переменных, без пробелов.</p>
        <table>
          <tr class="rowcategorytitle"><th colspan="2">Модификаторы переменных</th></tr>
          <tr class="rowsubtitle"><th class="namecolumn">Буква модификатора</th><th class="categorydesccolumn">Что означает</th></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">F</div></td><td class="hintcell">включить в список только файлы (применимо к переменным %L и %l)</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">Q</div></td><td class="hintcell">брать в кавычки имена с пробелами</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">q</div></td><td class="hintcell">брать в кавычки все имена</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">W</div></td><td class="hintcell">использовать только имя, без пути</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">P</div></td><td class="hintcell">использовать только путь, без имени</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">A</div></td><td class="hintcell">использовать кодировку ANSI (может использоваться с переменными %L и %O)</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">U</div></td><td class="hintcell">использовать кодировку UTF-8 (может использоваться с переменными %L и %O)</td></tr>
        </table>
        <p>И снова не волнуйтесь, пример будет ниже.</p>
        <p class="navback"><a href="#topofpage">(наверх)</a></p>
      </div>

      <div>
        <h2><a name="actionlist">5.4. Настройка действия "Список"</a></h2>
        <p>Если мы хотим, чтобы Double Commander работал с архивами, как если бы это был каталог с файлами, у нас должна быть возможность получить список файлов в архиве.</p>
        <p>На данный момент нам не нужно его распаковывать! Нет, это лишь вопрос получения списка его содержимого, чтобы Double Commander нам его показал.</p>
        <p>В нашем примере "rar.exe", смотрим его документацию и видим команду "v", которая позволит нам использовать консольное приложение "rar.exe" для получения списка файлов внутри архива:</p>
        <p class="figure"><img class="largeimage" title="Обзор" alt="Обзор" src="images/imgDC/archiveimg6.png" width="568" height="139"></p>
        <br>
        <p>Значит, для получения списка нам необходимо вызвать "rar.exe" с командой "v" и именем архива.</p>
        <p>Сначала проверим это вручную, с файлом E:\Temp\just.rar</p>
        <p class="figure"><img class="largeimage" title="Обзор" alt="Обзор" src="images/imgDC/archiveimg7.png" width="800" height="630"></p>
        <br>
        <p>Итак, теперь нам нужно настроить действие "Список", чтобы сообщить Double Commander, как вызвать "rar.exe" для получения содержимого сжатого файла.</p>
        <p>Чтобы сделать это, запишем то же, но уже используя описанные выше переменные и модификаторы.</p>
        <p>Вот как это будет выглядеть:</p>
        <p class="figure"><img class="largeimage" title="Обзор" alt="Обзор" src="images/imgDC/archiveimg8.png" width="86" height="41"></p>
        <p>У нас получилось <code>%P v %AQA</code>:</p>
        <ul>
          <li><code>%P</code> будет заменено нашим исполняемым файлом, то есть "E:\Program Files\WinRAR\Rar.exe"</li>
          <li><code>v</code> останется как есть, так как является командой архиватора "rar.exe" для просмотра списка файлов</li>
          <li><code>%A</code>&nbsp;&ndash; это имя архива, мы добавляем к нему <code>Q</code>, чтобы указать DC на необходимость взять имя в кавычки, если в нём есть пробелы, и с помощью <code>A</code> указываем использовать кодировку ANSI</li>
        </ul>
        <p>Таким образом, всё это для того, чтобы вызвать внешний архиватор с подходящими параметрами.</p>
        <p>Будет использовано при вызове внутренней команды <a href="cmds.html#cm_OpenArchive">cm_OpenArchive</a>.</p>
        <p class="navback"><a href="#topofpage">(наверх)</a></p>
      </div>

      <div>
        <h2><a name="recuperate">5.5. Получение списка содержимого</a></h2>
        <p>Теперь архиватор будет выводить список файлов внутри архивов.</p>
        <p>Но это еще не всё! Далее нам нужно разобрать вывод архиватора, приведя его к виду, необходимому для показа в файловой панели.</p>
        <p class="navback"><a href="#topofpage">(наверх)</a></p>
      </div>

      <div>
        <h2><a name="delimit">5.5.1. Разграничение области для анализа</a></h2>
        <p>Как мы видели на изображении выше, "rar.exe" выводит не просто голые данные.</p>
        <p>Есть некоторая информация, которую мы должны убрать, чтобы сохранить только необходимое.</p>
        <p>К счастью, мы можем указать Double Commander магическую строку, с которой DC начнёт анализ последующих строк.</p>
        <p>Кроме того, мы можем указать магическую строку, останавливающую разбор данных.</p>
        <p>Поскольку у нас есть пунктирная линия до и после, довольно просто установить эти два параметра:</p>
        <p class="figure"><img class="largeimage" title="Обзор" alt="Обзор" src="images/imgDC/archiveimg9.png" width="360" height="79"></p>
        <p>В случае, если внешний архиватор выводит данные сразу же, без дополнительных строк, просто оставьте эти поля пустыми.</p>
        <p>Символ карет "^" указывает, что магическая строка располагается в самом начале строки и никак иначе.</p>
        <p>Если магическая строка, останавливающая разбор данных, может быть спутана с именем файла, то DC может прекратить анализ слишком рано, поэтому, когда возможно, полезно уточнить, что эта строка должна начинаться с самого начала строки.</p>
        <p>Есть смысл установить "Конец списка" как можно дальше, но сохраняя его функцию: лучше и безопаснее убедиться, что в будущем не будет путаницы.</p>
        <p class="navback"><a href="#topofpage">(наверх)</a></p>
      </div>

      <div>
        <h2><a name="parsing">5.5.2. Разбор списка содержимого</a></h2>
        <p>Теперь DC точно знает, какие данные анализировать для получения списка файлов внутри архива.</p>
        <p>Было бы проще жёстко задать в приложении порядок анализа вывода "rar.exe", но Double Commander этого не делает.</p>
        <p>Вместо этого он чрезвычайно универсален, предоставляя нам возможность полностью настроить анализ!</p>
        <p>Это может быть немного сложнее, но, с другой стороны, это даёт нам максимальную гибкость, поскольку так мы можем использовать внешние архиваторы, о которых разработчики Double Commander даже не знали!</p>
        <p>Для извлечения информации из каждой строки списка файлов мы будем использовать шаблоны.</p>
        <p class="navback"><a href="#topofpage">(наверх)</a></p>
      </div>

      <div>
        <h2><a name="standardparsing">5.5.3. Стандартный синтаксис разбора вывода</a></h2>
        <p>Таблица ниже содержит выражения стандартного синтаксиса разбора вывода и, как мы увидим в примере, стандартный синтаксис преимущественно основана на прямой подстановке.</p>
        <p>Когда это возможно, мы будем стараться использовать этот синтаксис, поскольку он работает быстрее, чем описанный далее расширенный.</p>
        <table>
          <tr class="rowcategorytitle"><th colspan="2">Стандартный синтаксис разбора вывода</th></tr>
          <tr class="rowsubtitle"><th class="namecolumn">Выражение</th><th class="categorydesccolumn">Что означает</th></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">n</div></td><td class="hintcell">имя файла</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">z</div></td><td class="hintcell">размер несжатого файла</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">c</div></td><td class="hintcell">описание файла</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">p</div></td><td class="hintcell">размер сжатого файла</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">d</div></td><td class="hintcell">день</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">t</div></td><td class="hintcell">месяц</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">TTT</div></td><td class="hintcell">трёхбуквенное имя месяца (Jan, Feb, Mar, ...)</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">y</div></td><td class="hintcell">год</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">h</div></td><td class="hintcell">часы</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">H</div></td><td class="hintcell">буква-модификатор часов: a - время до полудня (a.m.), p - время после полудня (p.m.)</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">m</div></td><td class="hintcell">минуты</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">s</div></td><td class="hintcell">секунды</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">a</div></td><td class="hintcell">атрибуты</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">e</div></td><td class="hintcell">расширение файла</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">?</div></td><td class="hintcell">пропустить один символ</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">*</div></td><td class="hintcell">пропустить до первого пробела или конца строки</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">+</div></td><td class="hintcell">для имён файлов, расположенных в конце строки: использовать все символы до конца строки</td></tr>
        </table>
        <p class="navback"><a href="#topofpage">(наверх)</a></p>
      </div>

      <div>
        <h2><a name="standardexample">5.5.4. Пример со стандартным синтаксисом</a></h2>
        <p>Таким образом, вся суть заключается в том, чтобы использовать доступные выражения из предыдущей таблицы для создания шаблона "Формат списка", который в свою очередь укажет Double Commander, как этим архиватором получить содержимое архива: каталоги и имена файлов, размеры файлов, атрибуты, даты и т.д.</p>
        <p>Для удобства скопируем строку текста, полученного нами ранее при ручном запуске архиватора, в текстовый редактор, а строкой ниже напишем соответствующий шаблон из выражений предыдущей таблицы.</p>
        <p>Вот что у нас получится:</p>
        <p class="figure"><img class="largeimage" title="Обзор" alt="Обзор" src="images/imgDC/archiveimg10.png" width="818" height="150"></p>
        <p>Итак, мы написали шаблон:</p>
        <ul>
          <li>серия "a" соответствует атрибутам файлов</li>
          <li>серия "z" соответствует размеру несжатых файлов</li>
          <li>буквы даты и времени соответствуют дате и времени файлов</li>
          <li>серия "n", с запасом, соответствует именам файлов</li>
        </ul>
        <p>Теперь выделим наш архив "just.rar" в панели, нажмём <kbd>Enter</kbd>, чтобы войти в него как в каталог, и видим, что показ содержимое файла работает (за исключением последнего файла...):</p>
        <p class="figure"><img class="largeimage" title="Обзор" alt="Обзор" src="images/imgDC/archiveimg11.png" width="668" height="570"></p>
        <p class="navback"><a href="#topofpage">(наверх)</a></p>
      </div>

      <div>
        <h2><a name="advancedparsing">5.5.5. Расширенный синтаксис разбора вывода</a></h2>
        <p>Следующая таблица представляет нам расширенный синтаксис разбора вывода внешнего архиватора.</p>
        <p>Использование элементов этого синтаксиса требует немного больше времени для обработки, поэтому используйте их только тогда, когда иначе невозможно разрешить проблемную ситуацию.</p>
        <p>Пример его использования будет приведён в следующем разделе.</p>
        <table>
          <tr class="rowcategorytitle"><th colspan="2">Расширенный синтаксис разбора</th></tr>
          <tr class="rowsubtitle"><th class="namecolumn">Выражение</th><th class="categorydesccolumn">Что означает</th></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">+</div></td><td class="hintcell">после имени не в конце строки: использовать все символы до следующего пробела</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">+</div></td><td class="hintcell">после любого числового поля: использовать все цифры до первого нецифрового символа</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">n+</div></td><td class="hintcell">имя файла: использовать все символы до конца строки</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">z+</div></td><td class="hintcell">размер несжатого файла: использовать все цифры до первого нецифрового символа</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">p+</div></td><td class="hintcell">размер сжатого файла: использовать все цифры до первого нецифрового символа</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">$</div></td><td class="hintcell">пропустить все пробелы/табуляции до следующего символа или до конца строки</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">\</div></td><td class="hintcell">данные продолжаются на следующей строке (поддерживается максимум 2 строки)</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">x</div></td><td class="hintcell">в точности один пробел, если на этом месте находится другой символ, то вся строка игнорируется</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">z=1024</div></td><td class="hintcell">размер несжатого файла, умноженный на указанное значение (в данном случае: 1024)</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft">p=1024</div></td><td class="hintcell">размер сжатого файла, умноженный на указанное значение (в данном случае: 1024)</td></tr>
        </table>
        <p class="navback"><a href="#topofpage">(наверх)</a></p>
      </div>

      <div>
        <h2><a name="advancedexample">5.5.6. Пример с расширенным синтаксисом</a></h2>
        <p>Пример со стандартным синтаксисом оказался хорош, но не идеален.</p>
        <p>В некоторых случаях он будет работать неправильно.</p>
        <p>С огромными файлами размер будет намного шире, чем ожидалось, поэтому наша первая попытка не удалась.</p>
        <p>Посмотрите на наш файл <code>007 Skyfall.TS</code>.</p>
        <p>Мы видим, что отображается неверная информация. Давайте сравним:</p>
        <p class="figure"><img class="largeimage" title="Обзор" alt="Обзор" src="images/imgDC/archiveimg12.png" width="756" height="122"></p>
        <p>Видим ошибки в имени файла, размере, дате и т.д.</p>
        <p>Давайте для разрешения этой проблемной ситуации воспользуемся элементами расширенного синтаксиса.</p>
        <p>Вот что можно использовать, даже если выводимое поле не всегда *точно* одной и той же ширины:</p>
        <p class="figure"><img class="largeimage" title="Обзор" alt="Обзор" src="images/imgDC/archiveimg13.png" width="258" height="41"></p>
        <p>Немного сложнее, но очень легко описать, и в конце мы увидим, что всё это не так уж сложно.</p>
        <p>Раскрашенное описание поможет нам визуализировать каждый маленький блок разбора:</p>
        <p class="figure"><img class="largeimage" title="Обзор" alt="Обзор" src="images/imgDC/archiveimg14.png" width="678" height="495"></p>
        <p>Итак, используя эту строку формата списка, мы можем проверить снова и теперь у нас есть правильный результат даже для огромного файла:</p>
        <p class="figure"><img class="largeimage" title="Обзор" alt="Обзор" src="images/imgDC/archiveimg15.png" width="668" height="570"></p>
        <p class="navback"><a href="#topofpage">(наверх)</a></p>
      </div>

      <div>
        <h2><a name="actionextract">5.6. Настройка действия "Извлечь"</a></h2>
        <p>Это строка вызова внешнего архиватора для извлечения файла или всех файлов из выбранного архива, будем использовать те же <a href="#variables">переменные</a> и их <a href="#modifiers">модификаторы</a>.</p>
        <p>Продолжаем работу с "rar.exe", из документации мы знаем, что для извлечения файла или группы файлов используется команда "x".</p>
        <p>С "rar.exe" мы также можем указать в параметре список файлов для извлечения.</p>
        <p>Воспользуемся предлагаемой Double Commander переменной <code>%L</code>, которая создаст текстовый файл с выделенными для извлечения файлами, и передадим его как параметр.</p>
        <p>Ниже представлена строка для извлечения на примере "rar.exe":</p>
        <p class="figure"><img class="largeimage" title="Обзор" alt="Обзор" src="images/imgDC/archiveimg16.png" width="146" height="41"></p>
        <p>Описание этого примера:</p>
        <ul>
          <li><b>%P</b> будет заменено исполняемым файлом архиватора</li>
          <li><b>x</b>&nbsp;&ndash; это команда "rar.exe" для извлечения</li>
          <li><b>-y</b>&nbsp;&ndash; это параметр "rar.exe": использовать ответ "Да" на все запросы</li>
          <li><b>%AQA</b>&nbsp;&ndash; это имя архива. "Q" указывает DC, что необходимо взять имя в кавычки, если в нём есть пробелы, "A" указывает использовать кодировку ANSI</li>
          <li><b>@</b>&nbsp;&ndash; это символ-индикатор "rar.exe" для указания файла списка</li>
          <li><b>%LQA</b>&nbsp;&ndash; имя файла списка для обработки внешним архиватором</li>
        </ul>
        <p>Итак, эта команда будет вызываться, когда мы пожелаем извлечь всё содержимое выделенного архива, только один файл из него и т.д.</p>
        <p>Когда мы "входим" в архив как в каталог и нажимаем <kbd>F3</kbd>, чтобы просмотреть содержимое файла внутри архива, действие "Извлечь" происходит в фоне, выбранный файл извлекается с использованием этого шаблона во временный каталог, а уже оттуда передаётся просмотрщику.</p>
        <p>Будет использовано при вызове внутренней команды <a href="cmds.html#cm_ExtractFiles">cm_ExtractFiles</a>.</p>
        <p class="navback"><a href="#topofpage">(наверх)</a></p>
      </div>

      <div>
        <h2><a name="actionadding">5.7. Настройка действия "Добавить"</a></h2>
        <p>Это строка вызова внешнего архиватора для "упаковки" файла или всех выделенных файлов в архив, будем использовать те же <a href="#variables">переменные</a> и их <a href="#modifiers">модификаторы</a>.</p>
        <p>Продолжаем работу с "rar.exe", из документации мы знаем, что для создания архива или добавления файла или группы файлов в существующий архив используется команда "a".</p>
        <p>С "rar.exe" мы также можем указать в параметре список файлов для добавления.</p>
        <p>Воспользуемся предлагаемой Double Commander переменной <code>%L</code>, которая создаст текстовый файл с выделенными в активной панели файлами, и передадим его как параметр.</p>
        <p>Ниже представлена строка для создания или добавления в архив на примере "rar.exe":</p>
        <p class="figure"><img class="largeimage" title="Обзор" alt="Обзор" src="images/imgDC/archiveimg17.png" width="146" height="41"></p>
        <p>Описание этого примера:</p>
        <ul>
          <li><b>%P</b> будет заменено исполняемым файлом архиватора</li>
          <li><b>a</b>&nbsp;&ndash; это команда "rar.exe" для создания архива или добавления в уже существующий архив</li>
          <li><b>-y</b>&nbsp;&ndash; это параметр "rar.exe": использовать ответ "Да" на все запросы</li>
          <li><b>%AQA</b>&nbsp;&ndash; это имя архива. "Q" указывает DC, что необходимо взять имя в кавычки, если в нём есть пробелы, "A" указывает использовать кодировку ANSI</li>
          <li><b>@</b>&nbsp;&ndash; это символ-индикатор "rar.exe" для указания файла списка</li>
          <li><b>%LQA</b>&nbsp;&ndash; имя файла списка для обработки внешним архиватором</li>
        </ul>
        <p>Итак, эта команда будет вызвана, когда мы выберем файл или группу файлов и пожелаем упаковать с помощью внешнего архиватора "rar".</p>
        <p>Будет использовано при вызове внутренней команды <a href="cmds.html#cm_PackFiles">cm_PackFiles</a>.</p>
        <p class="navback"><a href="#topofpage">(наверх)</a></p>
      </div>

      <div>
        <h2><a name="actiondelete">5.8. Настройка действия "Удалить"</a></h2>
        <p>Некоторые форматы сжатых файлов поддерживают возможность удаления файла внутри архива.</p>
        <p>Если эта возможность поддерживается, мы можем в Double Commander настроить для этого вызов внешнего архиватора.</p>
        <p>То есть, когда эта команда будет использоваться: входим в архив, выбираем внутри него файл и удаляем его.</p>
        <p>Обратите внимание, что это действие находится на второй вкладке настроек внешнего архиватора.</p>
        <p>Продолжая наш пример с "rar.exe", вот как мы можем настроить это действие:</p>
        <p class="figure"><img class="largeimage" title="Обзор" alt="Обзор" src="images/imgDC/archiveimg18.png" width="148" height="41"></p>
        <p>Описание этого примера:</p>
        <ul>
          <li><b>%P</b> будет заменено исполняемым файлом архиватора</li>
          <li><b>d</b>&nbsp;&ndash; это команда "rar.exe" для удаления файла в архиве</li>
          <li><b>-y</b>&nbsp;&ndash; это параметр "rar.exe": использовать ответ "Да" на все запросы</li>
          <li><b>%AQA</b>&nbsp;&ndash; это имя архива. "Q" указывает DC, что необходимо взять имя в кавычки, если в нём есть пробелы, "A" указывает использовать кодировку ANSI</li>
          <li><b>@</b>&nbsp;&ndash; это символ-индикатор "rar.exe" для указания файла списка (да, мы можем удалить более одного файла за раз)</li>
          <li><b>%LQA</b>&nbsp;&ndash; имя файла списка для обработки внешним архиватором</li>
        </ul>
        <p class="navback"><a href="#topofpage">(наверх)</a></p>
      </div>

      <div>
        <h2><a name="actiontest">5.9. Настройка действия "Проверить"</a></h2>
        <p>Некоторые архиваторы позволяют проверить целостность файла архива, чтобы убедиться, что в них нет ошибки, что ничего не повреждено.</p>
        <p>Если эта возможность поддерживается, мы можем в Double Commander настроить для этого вызов внешнего архиватора.</p>
        <p>Продолжая наш пример с "rar.exe", вот как мы можем настроить это действие:</p>
        <p class="figure"><img class="largeimage" title="Обзор" alt="Обзор" src="images/imgDC/archiveimg19.png" width="98" height="41"></p>
        <p>Описание этого примера:</p>
        <ul>
          <li><b>%P</b> будет заменено исполняемым файлом архиватора</li>
          <li><b>t</b>&nbsp;&ndash; это команда "rar.exe" для проверки архива</li>
          <li><b>-y</b>&nbsp;&ndash; это параметр "rar.exe": использовать ответ "Да" на все запросы</li>
          <li><b>%AQA</b>&nbsp;&ndash; это имя архива. "Q" указывает DC, что необходимо взять имя в кавычки, если в нём есть пробелы, "A" указывает использовать кодировку ANSI</li>
        </ul>
        <p>Будет использовано при вызове внутренней команды <a href="cmds.html#cm_TestArchive">cm_TestArchive</a>.</p>
        <p>Если ошибок нет, окно тестирования будет закрыто, в противном случае появится следующее сообщение:</p>
        <p class="figure"><img class="largeimage" title="Обзор" alt="Обзор" src="images/imgDC/archiveimg20.png" width="550" height="184"></p>
        <p class="navback"><a href="#topofpage">(наверх)</a></p>
      </div>

      <div>
        <h2><a name="actionextractnpath">5.10. Настройка действия "Распаковать не учитывая пути"</a></h2>
        <p>Если архив содержит каталоги, то при вызове внутренней команды <a href="cmds.html#cm_ExtractFiles">cm_ExtractFiles</a> для распаковки по умолчанию архиватор будет воссоздавать структуру каталогов.</p>
        <p>Но иногда бывает необходимо извлечь все файлы без сохранения структуры каталогов и некоторые архиваторы поддерживают такую возможность.</p>
        <p>Для этого используется действие "Распаковать не учитывая пути".</p>
        <p>Продолжая наш пример с "rar.exe", вот как мы можем настроить это действие:</p>
        <p class="figure"><img class="largeimage" title="Обзор" alt="Обзор" src="images/imgDC/archiveimg24.png" width="218" height="41"></p>
        <p>Описание этого примера:</p>
        <ul>
          <li><b>%P</b> будет заменено исполняемым файлом архиватора</li>
          <li><b>e</b>&nbsp;&ndash; это команда "rar.exe" для извлечения файлов без сохранения структуры каталогов</li>
          <li><b>-y</b>&nbsp;&ndash; это параметр "rar.exe": использовать ответ "Да" на все запросы</li>
          <li><b>%AQA</b>&nbsp;&ndash; это имя архива. "Q" указывает DC, что необходимо взять имя в кавычки, если в нём есть пробелы, "A" указывает использовать кодировку ANSI</li>
          <li><b>@</b>&nbsp;&ndash; это символ-индикатор "rar.exe" для указания файла списка</li>
          <li><b>%LQA</b>&nbsp;&ndash; имя файла списка для обработки внешним архиватором</li>
        </ul>
        <p>Такой способ можно выбрать в диалоговом окне распаковки архива:</p>
        <p class="figure"><img class="largeimage" title="Обзор" alt="Обзор" src="images/imgDC/archiveimg23.png" width="464" height="266"></p>
        <p class="navback"><a href="#topofpage">(наверх)</a></p>
      </div>

      <div>
        <h2><a name="actionselfextract">5.11. Настройка действия "Создать самораспаковывающийся архив"</a></h2>
        <p>Некоторые архиваторы могут создавать "самораспаковывающиеся" сжатые файлы (SFX-архивы).</p>
        <p>Это означает, что в результате мы получим исполняемый файл, при запуске которого будет извлечено его содержимое.</p>
        <p>Это полезно, когда хотим быть уверены, что у пользователей не будет проблем с распаковкой архива: ничего не нужно устанавливать, просто запустить и получить распакованные файлы!</p>
        <p>Как правило, это действие зачастую настраивается так же, как действие "Добавить", но с добавлением параметра, указывающего, что нужен самораспаковывающийся архив.</p>
        <p>Так обстоит дело, например, с "rar.exe". Вот как мы можем настроить это действие:</p>
        <p class="figure"><img class="largeimage" title="Обзор" alt="Обзор" src="images/imgDC/archiveimg21.png" width="248" height="41"></p>
        <p>Описание этого примера:</p>
        <ul>
          <li><b>%P</b> будет заменено исполняемым файлом архиватора</li>
          <li><b>a</b>&nbsp;&ndash; это команда "rar.exe" для создания архива или добавления в уже существующий архив</li>
          <li><b>-y</b>&nbsp;&ndash; это параметр "rar.exe": использовать ответ "Да" на все запросы</li>
          <li><b>-sfx</b>&nbsp;&ndash; это параметр "rar.exe", указывающий, что результатом должен стать самораспаковывающийся архив</li>
          <li><b>%AQA</b>&nbsp;&ndash; это имя архива. "Q" указывает DC, что необходимо взять имя в кавычки, если в нём есть пробелы, "A" указывает использовать кодировку ANSI</li>
          <li><b>@</b>&nbsp;&ndash; это символ-индикатор "rar.exe" для указания файла списка</li>
          <li><b>%LQA</b>&nbsp;&ndash; имя файла списка для обработки внешним архиватором</li>
        </ul>
        <p>Самораспаковывающийся архив создаётся, как и обычный архив, с помощью внутренней команды <a href="cmds.html#cm_PackFiles">cm_PackFiles</a>, но в появившемся окне нужно отметить опцию "Самораспаковывающийся архив".</p>
        <p class="figure"><img class="largeimage" title="Обзор" alt="Обзор" src="images/imgDC/archiveimg22.png" width="540" height="297"></p>
        <p class="navback"><a href="#topofpage">(наверх)</a></p>
        <br>
      </div>

      <div>
        <h2><a name="configids">5.12. Использование ID</a></h2>
        <p>Мы можем настроить Double Commander таким образом, чтобы он игнорировал расширение файла и пытался определить сжатый файл по его содержимому, а затем вызывал описанные выше соответствующие команды получения списка и распаковки.</p>
        <p>Для этого мы будем использовать внутреннюю команду <a href="cmds.html#cm_OpenArchive">cm_OpenArchive</a>.</p>
        <p>Примером использования может быть открытие самораспаковывающегося EXE-файла и получение содержимого, не запуская его.</p>
        <p>Другим примером может быть просмотр содержимого архива, который сохраняется с иным, чем обычный архив, расширением файла, примером таких файлов могут быть, например, DOCX-файлы Microsoft Word, которые на самом деле представляют собой сжатые ZIP-файлы.</p>
        <p>Мы можем настроить DC для обнаружения сигнатуры выбранного файла (шаблона данных в определённом месте файла), чтобы он был распознан и передан соответствующему архиватору.</p>
        <p>Мы будем называть эти шаблоны "ID" и этот раздел посвящён их настройке.</p>
        <p>Для этого у нас есть три опции: ID, Смещение ID и Диапазон поиска ID.</p>
        <p>Мы укажем Double Commander, где нужно искать определённый ID для распознавания типа архива, а затем настроим команды, специфичные для этого типа архива.</p>
        <p>Начнем с простого примера. На следующем изображении показано начало архива 7-Zip в шестнадцатеричном виде:</p>
        <p class="figure"><img class="largeimage" title="Пример архива 7-Zip" alt="Пример архива 7-Zip" src="images/imgDC/archiveimg25.png" width="764" height="138"></p>
        <p>Посмотрев другие архивы 7-Zip, мы видим, что первые шесть байта&nbsp;&ndash; это всегда последовательность 0x37 0x7A 0xBC 0xAF 0x27 0x1C.</p>
        <p>Итак, извлечём из этого пользу: столкнувшись с файлом, который начинается с этой последовательности, Double Commander предположит, что этот файл является архивом 7-Zip.</p>
        <p>Настраиваем:</p>
        <p class="figure"><img class="largeimage" title="ID 7-Zip архива" alt="ID 7-Zip архива" src="images/imgDC/archiveimg26.png" width="130" height="121"></p>
        <p>Мы должны записать ID группами по два шестнадцатеричных числа, разделяя их пробелами.</p>
        <p>Смещение ID (необязательный)&nbsp;&ndash; это позиция ID в архиве. Если не указано, поиск ID будет идти с начала файла. Мы можем задать смещение со знаком "-" (минус): в этом случае поиск будет идти с конца файла. Специальное значение &lt;SeekID&gt; ограничивает поиск ID, если не найдено числовое значение смещения ID. Диапазоны поиска "0 .. размер файла" или "0 .. Диапазон поиска ID" (в зависимости от того, какое будет меньше). Значения могут быть указаны в десятеричной (12345) или шестнадцатеричной (0x3039) системе счисления. Отрицательные значения в шестнадцатеричном виде обозначаются как 0xFFFFFFFF (-1 в десятичном).</p>
        <p>Диапазон поиска ID (необязательный)&nbsp;&ndash; это число байт, в которых Double Commander будет искать ID, если задано &lt;SeekID&gt;. По умолчанию 1 МБ.</p>
        <p><b>Примечание:</b> Все вышеуказанные параметры могут иметь несколько значений, в таком случае можно перечислить их через запятую.</p>
        <p>В нашем примере с архивом 7-Zip будет достаточно указать ID и смещение ID (0, потому что в начале файла).</p>
        <p>Теперь, когда мы вызовем команду <a href="cmds.html#cm_OpenArchive">cm_OpenArchive</a>, Double Commander просканирует содержимое файла, найдёт последовательность "0x37 0x7A 0xBC 0xAF 0x27 0x1C" по смещению 0, и будет обрабатывать его как тип 7Z, с соответствующими командами и параметрами для получения списка, распаковки и т.д.</p>
        <p class="navback"><a href="#topofpage">(наверх)</a></p>
        <br>
      </div>
     </div>
    <div class="footer"><div class="nav"><a title="Начало" href="index.html">Начало</a> | <a title="Предыдущая страница" href="directoryhotlist.html">Пред.</a> | <a title="Следующая страница" href="toolbar.html">След.</a></div></div>
    <div class="checker">
      <a href="https://validator.w3.org/check?uri=referer" target="_blank"><img src="https://www.w3.org/Icons/valid-html40" alt="Valid HTML 4.0 Transitional" height="31" width="88"></a>
      <a href="https://jigsaw.w3.org/css-validator/check/referer" target="_blank"><img style="border:0;width:88px;height:31px" src="https://jigsaw.w3.org/css-validator/images/vcss" alt="CSS Valid!"></a>
    </div>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
  </body>
</html>
