<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
  <head>
    <title>DC - Скрипты Lua</title>
    <link rel="stylesheet" type="text/css" href="doublecmd.css">
    <link rel="shortcut icon" href="../../pixmaps/common/favicon.ico">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  </head>

  <body>
    <a name="topofpage"></a>
    <div class="header"><a href="index.html"><img src="../../pixmaps/common/dclogo2017.png" alt="Double Commander" height="48" width="374"></a>
      <div id="global-nav" class="nav"><a title="Домашняя страница Double Commander" href="https://doublecmd.sourceforge.io/" target="_blank">Домашняя страница</a> | <a title="Вики Double Commander" href="https://github.com/doublecmd/doublecmd/wiki" target="_blank">Вики</a></div>
    </div>
    <div class="footer"><div class="nav"><a title="Начало" href="index.html">Начало</a> | <a title="Предыдущая страница" href="regexp.html">Пред.</a> | <a title="Следующая страница" href="commandline.html">След.</a></div></div>

    <div class="dchelpage">
      <div>
        <h1>2.15. Скрипты Lua</h1>
      </div>

      <div>
        <h2>Содержание</h2>
        <dl>
          <dt>1. <a href="#preface">Введение</a></dt>
          <dt>2. <a href="#dllrequired">Необходимая DLL</a></dt>
          <dt>3. <a href="#libraries">Библиотеки функций Double Commander</a></dt>
          <dd>
            <dl>
              <dt>3.1. <a href="#libdc">Библиотека DC</a></dt>
              <dd>
                <dl>
                  <dt>3.1.1. <a href="#exampleex">Пример с DC.ExecuteCommand</a></dt>
                </dl>
              </dd>
              <dt>3.2. <a href="#librarysystem">Библиотека System</a></dt>
              <dd>
                <dl>
                  <dt>3.2.1. <a href="#detailattr">Описание возвращаемого значения SysUtils.FileGetAttr</a></dt>
                  <dt>3.2.2. <a href="#exampleattr">Пример с SysUtils.FileGetAttr</a></dt>
                  <dt>3.2.3. <a href="#examplefind">Пример использования FindFirst, FindNext и FindClose</a></dt>
                </dl>
              </dd>
              <dt>3.3. <a href="#libraryclip">Библиотека Clipboard</a></dt>
              <dd>
                <dl>
                  <dt>3.3.1. <a href="#exampleclip">Пример работы с буфером обмена</a></dt>
                </dl>
              </dd>
              <dt>3.4. <a href="#librarydialogs">Библиотека Dialogs</a></dt>
              <dd>
                <dl>
                  <dt>3.4.1. <a href="#dlgbuts">Кнопки Dialogs.MessageBox</a></dt>
                  <dt>3.4.2. <a href="#dlgstyle">Стиль окна Dialogs.MessageBox</a></dt>
                  <dt>3.4.3. <a href="#dlgdefbut">Кнопка по умолчанию в Dialogs.MessageBox</a></dt>
                  <dt>3.4.4. <a href="#msgreturn">Возвращаемое значение Dialogs.MessageBox</a></dt>
                  <dt>3.4.5. <a href="#mesgboxsample">Пример использования Dialogs.MessageBox</a></dt>
                  <dt>3.4.6. <a href="#querysample">Пример использования Dialogs.InputQuery</a></dt>
                </dl>
              </dd>
              <dt>3.5. <a href="#libraryutf8">Библиотека UTF-8</a></dt>
              <dt>3.6. <a href="#librarychar">Библиотека Char</a><span class="versionref"><sup>(Бета-версия)</sup></span></dt>
              <dt>3.7. <a href="#libraryos">Библиотека OS</a></dt>
            </dl>
          </dd>
        </dl>
      </div>

      <div>
        <h2><a name="preface">1. Введение</a></h2>
        <p>Подробную информацию о скриптовом языке программирования Lua можно найти на <a href="https://www.lua.org/" target="_blank">веб-сайте Lua</a>.</p>
        <p>Double Commander может выполнять скрипты Lua с помощью команды <a href="cmds.html#cm_ExecuteScript">cm_ExecuteScript</a>.<br>
          Параметры скриптов должны передаваться как есть, без экранирования (без кавычек или "\"), для этого необходимо использовать переменную <a href="variables.html#quotation">%"0</a>: например, <code>%"0%p0</code> для файла под курсором вместо <code>%p0</code> или <code>%"0%D</code> для текущего каталога вместо <code>%D</code>. В противном случае, если Double Commander автоматически добавит кавычки, они будут переданы как часть параметра и вам придётся их учитывать.<br>
          Для получения списка всех выделенных файлов мы можем использовать <a href="variables.html#listoffiles">переменные</a> (<code>%LU</code>, <code>%FU</code> или <code>%RU</code>) или внутренние команды (<a href="cmds.html#cm_SaveSelectionToFile">cm_SaveSelectionToFile</a>, <a href="cmds.html#cm_SaveFileDetailsToFile">cm_SaveFileDetailsToFile</a><span class="versionref"><sup>(Бета-версия)</sup></span>, <a href="cmds.html#cm_CopyFullNamesToClip">cm_CopyFullNamesToClip</a> или <a href="cmds.html#cm_CopyFileDetailsToClip">cm_CopyFileDetailsToClip</a>).
          Мы можем использовать, например, <code>%p</code>: в этом случае Double Commander передаст имена всех выделенных файлов одной строкой, разделяя имена пробелом.</p>
        <p>Также на языке Lua можно писать информационные плагины, примеры можно найти в папке программы (<tt>plugins/wdx/scripts</tt>).
          В Вики есть <a href="https://github.com/doublecmd/doublecmd/wiki/Plugins-development" target="_blank">страница</a>, посвящённая написанию плагинов.
          Ограничения: поддерживаются только следующие типы данных</p>
        <ul>
          <li><i>ft_numeric_32</i> (1)&nbsp;&ndash; 32-битное целое число со знаком;</li>
          <li><i>ft_numeric_64</i> (2)&nbsp;&ndash; 64-битное целое число со знаком;</li>
          <li><i>ft_numeric_floating</i> (3)&nbsp;&ndash; число с плавающей запятой;</li>
          <li><i>ft_boolean</i> (6)&nbsp;&ndash; логический (булев) тип: <i>true</i> или <i>false</i>;</li>
          <li><i>ft_multiplechoice</i> (7)&nbsp;&ndash; значение, допускающее ограниченное количество вариантов выбора;</li>
          <li><i>ft_string</i> (8)&nbsp;&ndash; текстовая строка;</li>
          <li><i>ft_fulltext</i> (9)&nbsp;&ndash; полный текст (многострочный текст), используется только для поиска с помощью плагинов;</li>
          <li><i>ft_datetime</i> (10)&nbsp;&ndash; для даты/времени: возвращаемая дата будет сконвертирована в отформатированную строку даты и времени (значение зависит от ваших региональных настроек).<br>
            Дата должна быть в формате Windows, но в Lua и в функциях, которые Double Commander предоставляет для поиска файлов, используется время в формате Unix. Для конвертации мы можем использовать формулу:<br>
            =&nbsp;UnixTime&nbsp;*&nbsp;10000000&nbsp;+&nbsp;116444736000000000<br>
            Это большое число, поэтому потребуется 64-битная версия Double Commander или Lua 5.3+.</li>
        </ul>
        <p>Список выше содержит имена из заголовочных файлов, в скриптах Lua мы должны использовать цифровые значения, которые указаны в скобках.</p>
        <p>Примечание: Для диалога <a href="help.html#cm_FileProperties">свойств файла</a> функция <code>ContentGetValue</code> вызывается с флагом <code>CONTENT_DELAYIFSLOW</code> (четвёртый параметр, значение равно 1), это позволяет избежать задержки открытия окна: если получение данных медленное, мы можем эти данные исключить, просто добавляем проверку значения флага и возвращаем <code>nil</code> для таких полей или плагина.</p>
        <p>Примечание: Если плагин должен вернуть пустую строку, то более быстрым будет передать <code>nil</code> вместо <code>""</code>.</p>
        <p>Примечание: Функция Lua <code>io.open</code> использует стандартную функцию C <code>fopen</code>: в текстовом режиме эта функция может преобразовывать тип окончания строк (CRLF, LF или CR) при чтении и записи, что может привести к неожиданному результату. Если вам попадаются файлы с разным типом окончания строк или вы пишете кроссплатформенный скрипт, это необходимо учитывать или может быть практичнее отдать предпочтение бинарному режиму.</p>
        <br>

        <p><span class="bold">О кодировке текста</span></p>
        <p>Все дополнительные функции, описанные ниже, принимают строковые параметры в кодировке UTF-8 и возвращают строки в этой кодировке (за исключением функции <a href="#libraryutf8">LazUtf8.ConvertEncoding</a>).</p>
        <p>Часть функций из стандартных библиотек Lua заменены на функции из Double Commander или Free Pascal/Lazarus (или написаны новые), это обеспечивает поддержку UTF-8.</p>
        <p>При написании плагинов мы также должны использовать UTF-8 для текстовых данных (<i>ft_multiplechoice</i>, <i>ft_string</i> и <i>ft_fulltext</i>).</p>
        <p>При сохранении скриптов используйте кодировку UTF-8 без BOM.</p>
        <p class="navback"><a href="#topofpage">(наверх)</a></p>
      </div>

      <div>
        <h2><a name="dllrequired">2. Необходимая DLL</a></h2>
        <p>Чтобы использовать скрипты Lua, нам требуется интерпретатор Lua, Double Commander поддерживает версии 5.1 - 5.4.</p>
        <p>По умолчанию DC ищет файл с именем <tt>lua5.1.dll</tt> (Windows), <tt>liblua5.1.so.0</tt> (Unix или GNU/Linux) или <tt>liblua5.1.dylib</tt> (macOS<sup>(<a title="Примечание о поддержке macOS" href="https://github.com/doublecmd/doublecmd/wiki/Supported-platforms#macos" target="_blank">*</a>)</sup>) в своём каталоге и в системном. Мы можем изменить имя файла (и путь) в параметре <a href="configuration.html#luapathtolibrary">Библиотека Lua</a>.</p>
        <p>Мы можем использовать DLL-файл <a href="https://luajit.org/" target="_blank">проекта LuaJIT</a>.
           LuaJIT сочетает в себе высокоскоростной интерпретатор, написанный на ассемблере, и JIT-компилятор. Также мы получаем библиотеку FFI: с её помощью в скриптах можно будет вызывать внешние функции C и использовать структуры данных C.</p>
        <p>Дистрибутивы DC для Windows включают в себя DLL-файл Lua (в DC 0.9.7 и новее из проекта LuaJIT), в иных случаях мы можем найти и установить его с помощью менеджера пакетов или скомпилировать. Если используем 64-битную версию DC, то DLL-файл также должен быть 64-битным.</p>
        <p class="navback"><a href="#topofpage">(наверх)</a></p>
      </div>

      <div>
        <h2><a name="libraries">3. Библиотеки функций Double Commander</a></h2>
        <p>Double Commander предлагает несколько библиотек функций для скриптов Lua, список представлен ниже.</p>
        <table>
          <tr class="rowcategorytitle"><th colspan="3">Список библиотек</th></tr>
          <tr class="rowsubtitle"><th class="namecolumn">Библиотека</th><th class="namecolumn">Имя функции</th><th class="categorydesccolumn">Краткое описание</th></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft"><a href="#libdc">Double Commander</a></div></td><td class="hintcell">DC</td><td class="hintcell">Специфические функции Double Commander</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft"><a href="#librarysystem">System</a></div></td><td class="hintcell">SysUtils</td><td class="hintcell">Различные системные функции</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft"><a href="#libraryclip">Clipboard</a></div></td><td class="hintcell">Clipbrd</td><td class="hintcell">Различные функции для работы с буфером обмена</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft"><a href="#librarydialogs">Dialogs</a></div></td><td class="hintcell">Dialogs</td><td class="hintcell">Взаимодействие с пользователем</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft"><a href="#libraryutf8">UTF-8</a></div></td><td class="hintcell">LazUtf8</td><td class="hintcell">Строковые функции для работы с UTF-8</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft"><a href="#librarychar">Char</a></div></td><td class="hintcell">Char</td><td class="hintcell">Получение информации о символах</td></tr>
          <tr><td class="varcell"><div class="firstcolumnaleft"><a href="#libraryos">OS</a></div></td><td class="hintcell">os</td><td class="hintcell">Функции, связанные с операционной системой</td></tr>
        </table>
        <p class="navback"><a href="#topofpage">(наверх)</a></p>
      </div>

      <div>
        <h2><a name="libdc">3.1. Библиотека DC</a></h2>
        <p>Эта библиотека содержит специфические функции Double Commander, все функции представлены в таблице <code>DC</code>.</p>
        <table>
          <tr class="rowcategorytitle"><th colspan="2">Библиотека DC</th></tr>
          <tr class="rowsubtitle"><th class="categorynamecolumn">Функция</th><th class="categorydesccolumn">Описание</th></tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">DC.LogWrite</div></td>
            <td class="hintcell">
              <p class="definition">DC.LogWrite(sMessage, iMsgType, bForce, bLogFile)</p>
              <p>Пишет сообщение в окно протокола.</p>
              <p>Описание:</p>
              <ul>
                <li><var>sMessage</var> : Текст сообщения.</li>
                <li><var>iMsgType</var> : Тип сообщения: 0 - информационное, 1 - успешная операция, 2 - ошибка.</li>
                <li><var>bForce</var> : Логическое (булево) значение, если <code>true</code>, то показать окно протокола (если оно скрыто).</li>
                <li><var>bLogFile</var> : Логическое (булево) значение, если <code>true</code>, то сообщение будет записано и в файл протокола.</li>
              </ul>
            </td>
          </tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">DC.CurrentPanel</div></td>
            <td class="hintcell">
              <p class="definition">iPanel = DC.CurrentPanel()</p>
              <p>Получить активную панель: возвращает 0, если активна левая панель, или 1, если правая.</p>
              <p class="definition">DC.CurrentPanel(iPanel)</p>
              <p>Сделать активной: левую панель, если <var>iPanel</var> равно 0, или правую, если равно 1.</p>
            </td>
          </tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">DC.ExecuteCommand</div></td>
            <td class="hintcell">
              <p class="definition">DC.ExecuteCommand(sCommand, Param1, Param2,...,ParamX)</p>
              <p>Вызывает внутреннюю команду Double Commander <var>sCommand</var> с параметрами <var>Param1</var>..<var>ParamX</var>.</p>
              <p>Мы можем подставить столько <var>Param...</var>, сколько поддерживает команда <var>Command</var>.</p>
            </td>
          </tr>
        </table>
        <p><b>Примечание</b>: Скрипты работают в основном потоке Double Commander, поэтому иногда последовательное выполнение <a href="cmds.html#catnavigation">команд для навигации</a> может не сработать (например, большие каталоги, медленный диск), в этом случае попробуйте отключить <i>Загружать список файлов в отдельном потоке</i> в <a href="configuration.html#ConfigViewEx">настройках</a>.</p>
        <p class="navback"><a href="#topofpage">(наверх)</a></p>
      </div>

      <div>
        <h2><a name="exampleex">3.1.1. Пример с DC.ExecuteCommand</a></h2>
        <p>В этом примере мы написали простой скрипт, который сделает следующее:</p>
        <ol>
          <li>перенесёт фокус на правую панель</li>
          <li>закроет все открытые вкладки</li>
          <li>перейдёт в указанную папку</li>
          <li>перенесёт фокус на левую панель</li>
          <li>закроет все открытые вкладки</li>
          <li>перейдёт в указанный каталог</li>
          <li>откроет новую вкладку</li>
          <li>перейдёт в указанный каталог</li>
        </ol>

        <pre>
<span class="luacmt">-- 1. Перенести фокус на правую панель.</span>
<span class="mark">DC.ExecuteCommand</span><span class="luasbl">(</span><span class="luastr">"cm_FocusSwap"</span>, <span class="luastr">"side=right"</span><span class="luasbl">)</span>

<span class="luacmt">-- 2. Закрыть все вкладки.</span>
<span class="mark">DC.ExecuteCommand</span><span class="luasbl">(</span><span class="luastr">"cm_CloseAllTabs"</span><span class="luasbl">)</span>

<span class="luacmt">-- 3. Перейти в указанный каталог.</span>
<span class="mark">DC.ExecuteCommand</span><span class="luasbl">(</span><span class="luastr">"cm_ChangeDir"</span>, <span class="luastr">"E:\\FakeKey\\Documents\\Music"</span><span class="luasbl">)</span>

<span class="luacmt">-- 4. Перенести фокус на левую панель.</span>
<span class="mark">DC.ExecuteCommand</span><span class="luasbl">(</span><span class="luastr">"cm_FocusSwap"</span>, <span class="luastr">"side=left"</span><span class="luasbl">)</span>

<span class="luacmt">-- 5. Закрыть все вкладки.</span>
<span class="mark">DC.ExecuteCommand</span><span class="luasbl">(</span><span class="luastr">"cm_CloseAllTabs"</span><span class="luasbl">)</span>

<span class="luacmt">-- 6. Перейти в указанный каталог.</span>
<span class="mark">DC.ExecuteCommand</span><span class="luasbl">(</span><span class="luastr">"cm_ChangeDir"</span>, <span class="luastr">"C:\\Users\\Public\\Music"</span><span class="luasbl">)</span>

<span class="luacmt">-- 7. Открыть новую вкладку.</span>
<span class="mark">DC.ExecuteCommand</span><span class="luasbl">(</span><span class="luastr">"cm_NewTab"</span><span class="luasbl">)</span>

<span class="luacmt">-- 8. Перейти в указанный каталог.</span>
<span class="mark">DC.ExecuteCommand</span><span class="luasbl">(</span><span class="luastr">"cm_ChangeDir"</span>, <span class="luastr">"E:\\VirtualMachines\\ShareFolder"</span><span class="luasbl">)</span></pre>

        <p>Для выполнения нашего скрипта мы можем создать кнопку на панели инструментов с внутренней командой <a href="cmds.html#cm_ExecuteScript">cm_ExecuteScript</a>.</p>
        <p>Предположим, наш скрипт <code>E:\scripts\lua\music.lua</code>, мы можем настроить эту кнопку следующим образом:</p>
        <p class="figure"><img class="largeimage" title="Вызов скрипта Lua кнопкой панели инструментов" alt="Вызов скрипта Lua кнопкой панели инструментов" src="images/imgDC/luaimg1.png" width="560" height="290"></p>

        <p>Кроме того, для редактирования наших скриптов мы можем использовать встроенный редактор Double Commander.</p>
        <p>Если файл имеет расширение <code>.lua</code>, то он будет распознан редактором и открыт с подсветкой синтаксиса, специфичного для языка Lua:</p>
        <p class="figure"><img class="largeimage" title="Подсветка синтаксиса Lua во встроенном редакторе" alt="Подсветка синтаксиса Lua во встроенном редакторе" src="images/imgDC/luaimg2.png" width="660" height="480"></p>
        <p class="navback"><a href="#topofpage">(наверх)</a></p>
      </div>

      <div>
        <h2><a name="librarysystem">3.2. Библиотека System</a></h2>
        <p>Эта библиотека содержит различные системные функции, все они представлены в таблице <code>SysUtils</code>.</p>
        <table>
          <tr class="rowcategorytitle"><th colspan="2">Библиотека System</th></tr>
          <tr class="rowsubtitle"><th class="categorynamecolumn">Функция</th><th class="categorydesccolumn">Описание</th></tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">SysUtils.Sleep</div></td>
            <td class="hintcell">
              <p class="definition">SysUtils.Sleep(iMilliseconds)</p>
              <p>Приостанавливает выполнение скрипта на указанное количество миллисекунд (<var>iMilliseconds</var>), выполнение сценария будет продолжено после истечения указанного времени.</p>
            </td>
          </tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">SysUtils.GetTickCount</div></td>
            <td class="hintcell">
              <p class="definition">SysUtils.GetTickCount()</p>
              <p>Возвращает количество интервалов времени (тиков) с момента старта системы. Это полезно для измерения времени, но не следует делать каких-либо предположений относительно количества времени в интервале между тиками.</p>
            </td>
          </tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">SysUtils.FileExists</div></td>
            <td class="hintcell">
              <p class="definition">bExists = SysUtils.FileExists(sFileName)</p>
              <p>Проверяет, существует ли в файловой системе определённый файл.</p>
              <p><code>FileExists</code> возвращает <code>true</code>, если файл с именем <var>sFileName</var> существует на диске, и <code>false</code> в противном случае.</p>
            </td>
          </tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">SysUtils.DirectoryExists</div></td>
            <td class="hintcell">
              <p class="definition">bExists = SysUtils.DirectoryExists(sDirectory)</p>
              <p>Проверяет существование <var>sDirectory</var> в файловой системе и что это действительно каталог.</p>
              <p>Если это так, то функция возвращает <code>true</code>, иначе возвращает <code>false</code>.</p>
            </td>
          </tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">SysUtils.FileGetAttr</div></td>
            <td class="hintcell">
              <p class="definition">iAttr = SysUtils.FileGetAttr(sFileName)</p>
              <p>Возвращает в <var>iAttr</var> атрибуты файла <var>sFileName</var>.</p>
              <p>Подробное описание возвращаемого значения смотрите <a href="#detailattr">здесь</a>.</p>
            </td>
          </tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">SysUtils.FindFirst</div></td>
            <td class="hintcell">
              <p class="definition">Handle, FindData = SysUtils.FindFirst(sPath)</p>
              <p>Ищет файлы, совпадающие с <var>sPath</var> (можно использовать маски).</p>
              <p>Если файл не найден, <var>Handle</var> будет равно <code>nil</code>.</p>
              <p>В случае успеха функция вернёт дескриптор поиска <var>Handle</var> для последующих вызовов <code>SysUtils.FindNext</code> и поиска других совпадений с паттерном.</p>
              <p>Таблица <var>FindData</var> содержит информацию о найденном файле или каталоге.</p>
              <p>Поля таблицы <var>FindData</var>:</p>
              <ul>
                <li><var>Name</var> : Имя файла (без пути).</li>
                <li><var>Attr</var> : Атрибуты файла (подробнее смотрите <a href="#detailattr">здесь</a>).</li>
                <li><var>Size</var> : Размер файла в байтах.</li>
                <li><var>Time</var> : Отметка времени файла (в формате POSIX, так называемое Unix-время: количество секунд, прошедших с 1 января 1970 г.)</li>
              </ul>
            </td>
          </tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">SysUtils.FindNext</div></td>
            <td class="hintcell">
              <p class="definition">Result, FindData = SysUtils.FindNext(Handle)</p>
              <p>Находит следующее вхождение поиска, инициированного <code>FindFirst</code>, <var>Handle</var>&nbsp;&ndash; дескриптор поиска, возвращённый функцией <code>FindFirst</code>.</p>
              <p>В случае успеха функция вернёт <var>Result</var> не равный <code>nil</code> и таблицу <var>FindData</var>, содержащую информацию о найденном файле или каталоге.</p>
              <p><b><span class="uline">Замечание:</span> За последним вызовом <code>SysUtils.FindNext</code> всегда должен следовать вызов <code>SysUtils.FindClose</code> с тем же <var>Handle</var>. Несоблюдение этого приведёт к утечке памяти.</b></p>
            </td>
          </tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">SysUtils.FindClose</div></td>
            <td class="hintcell">
              <p class="definition">SysUtils.FindClose(Handle)</p>
              <p>Завершает серию вызовов <code>SysUtils.FindFirst</code>/<code>SysUtils.FindNext</code> и освобождает использованную память.</p>
              <p>Вызов этой функции <em>абсолютно</em> необходим, иначе могут возникнуть большие утечки памяти.</p>
            </td>
          </tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">SysUtils.CreateDirectory</div></td>
            <td class="hintcell">
              <p class="definition">bResult = SysUtils.CreateDirectory(sDirectory)</p>
              <p>Создаёт цепочку каталогов, <var>sDirectory</var> - полный путь каталога.</p>
              <p>Возвращает <code>true</code>, если <var>sDirectory</var> уже существует или был успешно создан, или <code>false</code>, если не удалось создать какую-либо часть пути.</p>
            </td>
          </tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">SysUtils.CreateHardLink</div></td>
            <td class="hintcell">
              <p class="definition">bResult = SysUtils.CreateHardLink(sFileName, sLinkName)</p>
              <p>Создаёт жёсткую ссылку <var>sLinkName</var> на файл <var>sFileName</var>.</p>
              <p>Возвращает <code>true</code> в случае успеха, иначе возвращает <code>false</code>.</p>
            </td>
          </tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">SysUtils.CreateSymbolicLink</div></td>
            <td class="hintcell">
              <p class="definition">bResult = SysUtils.CreateSymbolicLink(sFileName, sLinkName)</p>
              <p>Создаёт символьную ссылку <var>sLinkName</var> на файл <var>sFileName</var>.</p>
              <p>Возвращает <code>true</code> в случае успеха, иначе возвращает <code>false</code>.</p>
            </td>
          </tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">SysUtils.ReadSymbolicLink</div></td>
            <td class="hintcell">
              <p class="definition">sTarget = SysUtils.ReadSymbolicLink(sLinkName, bRecursive)</p>
              <p>Читает имя файла, на который указывает символьная ссылка <var>sLinkName</var>.</p>
              <p>Если <var>bRecursive</var> равно <code>true</code> и ссылка указывает на ссылку, то она разрешается рекурсивно до тех пор, пока не будет найдено допустимое имя файла, не являющееся ссылкой.</p>
              <p>Возвращает путь, на который указывает символьная ссылка <var>sLinkName</var>, или пустую строку, если ссылка недействительна или файл, на который она указывает, не существует и значение <var>bRecursive</var> равно <code>true</code>.</p>
            </td>
          </tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">SysUtils.ExtractFileName</div></td>
            <td class="hintcell">
              <p class="definition">sName = SysUtils.ExtractFileName(sFileName)</p>
              <p>Возвращает имя файла из полного (имя+путь) имени файла.</p>
              <p>Имя файла содержит все символы после последнего символа разделителя каталогов ("/" или "\") или буквы диска.</p>
            </td>
          </tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">SysUtils.ExtractFileExt</div></td>
            <td class="hintcell">
              <p class="definition">sExt = SysUtils.ExtractFileExt(sFileName)</p>
              <p>Возвращает расширение файла (все символы после последней точки, включая сам символ ".").</p>
            </td>
          </tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">SysUtils.ExtractFilePath</div></td>
            <td class="hintcell">
              <p class="definition">sPath = SysUtils.ExtractFilePath(sFileName)</p>
              <p>Возвращает путь из полного имени файла (включая букву диска).</p>
              <p>Путь содержит все символы до последнего символа разделителя каталогов ("/" или "\"), включая сам разделитель каталогов.</p>
            </td>
          </tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">SysUtils.ExtractFileDir</div></td>
            <td class="hintcell">
              <p class="definition">sDir = SysUtils.ExtractFileDir(sFileName)</p>
              <p>Возвращает только каталог из <var>sFileName</var>, включая букву диска.</p>
              <p>Результат НЕ содержит разделитель каталогов в конце, в отличие от <code>SysUtils.ExtractFilePath</code>.</p>
            </td>
          </tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">SysUtils.ExtractFileDrive</div></td>
            <td class="hintcell">
              <p class="definition">sDrive = SysUtils.ExtractFileDrive(sFileName)</p>
              <p>Возвращает диск из полного имени файла.</p>
              <p>Обратите внимание, некоторые операционные системы не поддерживают буквы дисков.</p>
            </td>
          </tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">SysUtils.GetAbsolutePath</div></td>
            <td class="hintcell">
              <p class="definition">sName = SysUtils.GetAbsolutePath(sFileName, sBaseDirectory)</p>
              <p>Возвращает абсолютный (полный) путь к файлу:</p>
              <ul>
                <li><var>sFileName</var> : Имя файла с относительным путём.</li>
                <li><var>sBaseDirectory</var> : Каталог, который использовался как базовый каталог для <var>sFileName</var>.</li>
              </ul>
            </td>
          </tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">SysUtils.GetRelativePath</div></td>
            <td class="hintcell">
              <p class="definition">sName = SysUtils.GetRelativePath(sFileName, sBaseDirectory)</p>
              <p>Возвращает имя файла относительно указанного каталога:</p>
              <ul>
                <li><var>sFileName</var> : Полное (абсолютное) имя файла.</li>
                <li><var>sBaseDirectory</var> : Каталог, который будет использоваться как базовый каталог для <var>sFileName</var>.</li>
              </ul>
              <p>Если <var>sFileName</var> и <var>sBaseDirectory</var> содержат одно и то же значение, функция вернёт пустую строку ("").</p>
            </td>
          </tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">SysUtils.MatchesMask</div></td>
            <td class="hintcell">
              <p class="definition">bResult = SysUtils.MatchesMask(sFileName, sMask, iMaskOptions)</p>
              <p>Возвращает <code>true</code>, если <var>sFileName</var> совпадает с переданной маской <var>sMask</var>.</p>
              <p><var>iMaskOptions</var> (необязательный параметр, по умолчанию 0) задаётся как сумма следующих значений:</p>
              <table class="innercmddesc">
                <tr class="rowinnerdesc">
                  <th class="innerdescheader">Значение</th>
                  <th class="innerdescheader">Описание</th>
                </tr>
                <tr>
                  <td class="varcell"><div class="firstcolumnaleft">1</div></td>
                  <td class="hintcell">с учётом регистра</td>
                </tr>
                <tr>
                  <td class="varcell"><div class="firstcolumnaleft">2</div></td>
                  <td class="hintcell">игнорировать акценты и лигатуры</td>
                </tr>
                <tr>
                  <td class="varcell"><div class="firstcolumnaleft">4</div></td>
                  <td class="hintcell">фильтр в стиле Windows: "*.*" также совпадает с файлами без расширения и т.д.</td>
                </tr>
                <tr>
                  <td class="varcell"><div class="firstcolumnaleft">8</div></td>
                  <td class="hintcell">включить поддержку пиньинь (будет использоваться файл <tt>pinyin.tbl</tt>)</td>
                </tr>
              </table>
            </td>
          </tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">SysUtils.MatchesMaskList</div></td>
            <td class="hintcell">
              <p class="definition">bResult = SysUtils.MatchesMaskList(sFileName, sMaskList, sSeparator, iMaskOptions)</p>
              <p>Возвращает <code>true</code>, если <var>sFileName</var> совпадает с хотя бы одной из переданных масок <var>sMaskList</var>, разделённых <var>sSeparator</var> (по умолчанию ";").</p>
              <p><var>sSeparator</var> и <var>iMaskOptions</var> (см. выше)&nbsp;&ndash; необязательные параметры.</p>
            </td>
          </tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">SysUtils.PathDelim</div></td>
            <td class="hintcell">
              <p class="definition">SysUtils.PathDelim</p>
              <p>Символ, используемый в текущей операционной системе для разделения имён каталогов в полном имени файла.</p>
              <p>В системах Unix/Linux разделителем каталогов будет "/" и "\" в Windows.</p>
            </td>
          </tr>
        </table>
        <p class="navback"><a href="#topofpage">(наверх)</a></p>
      </div>

      <div>
        <h2><a name="detailattr">3.2.1. Описание возвращаемого значения SysUtils.FileGetAttr</a></h2>
        <p><code>FileGetAttr</code> возвращает атрибуты <var>sFileName</var> в виде ИЛИ-совокупности следующих констант:</p>
        <table>
          <tr class="rowcategorytitle"><th colspan="2">Константы, используемые в возвращаемом значении SysUtils.FileGetAttr</th></tr>
          <tr class="rowsubtitle"><th class="categorynamecolumn">Значение</th><th class="categorydesccolumn">Описание</th></tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">0x00000001<br><small class="firstcolumnaleft">faReadOnly</small></div></td>
            <td class="hintcell">Файл только для чтения.</td>
          </tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">0x00000002<br><small class="firstcolumnaleft">faHidden</small></div></td>
            <td class="hintcell">Скрытый файл.<br>В Unix/Linux это значит, что имя файла начинается с точки.</td>
          </tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">0x00000004<br><small class="firstcolumnaleft">faSysFile</small></div></td>
            <td class="hintcell">Системный файл.<br>В Unix/Linux это может быть символьное или блочное физическое устройство, именованный канал (FIFO).</td>
          </tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">0x00000008<br><small class="firstcolumnaleft">faVolumeId</small></div></td>
            <td class="hintcell">Метка тома (означает, что файл содержит идентификатор (ID) тома).<br>Только для DOS/Windows 9x на обычной файловой системе FAT (не VFAT или FAT32).</td>
          </tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">0x00000010<br><small class="firstcolumnaleft">faDirectory</small></div></td>
            <td class="hintcell">Каталог.</td>
          </tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">0x00000020<br><small class="firstcolumnaleft">faArchive</small></div></td>
            <td class="hintcell">Архивный.<br>Не используется в Unix/Linux.</td>
          </tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">0x00000400<br><small class="firstcolumnaleft">faSymLink</small></div></td>
            <td class="hintcell">Символьная ссылка.</td>
          </tr>
          <tr>
            <td colspan="2"><b>Примечание: В случае ошибки функция возвращает -1.</b>
          </tr>
        </table>
        <p>Смотрите пример в <a href="#exampleattr">следующей секции</a>.</p>
        <p class="navback"><a href="#topofpage">(наверх)</a></p>
      </div>

      <div>
        <h2><a name="exampleattr">3.2.2. Пример с SysUtils.FileGetAttr</a></h2>
        <p>Пример скрипта ниже использует <code>SysUtils.FileGetAttr</code>.</p>
        <p>Если параметр окажется каталогом, то скрипт откроет его в новой вкладке активной панели и переключится на неё.</p>
        <pre>
<span class="luakyw">local</span> params <span class="luasbl">=</span> <span class="luasbl">{...}</span>
<span class="luakyw">local</span> iAttr

<span class="luakyw">if</span> <span class="luasbl">#</span>params <span class="luasbl">==</span> <span class="luanum">1</span> <span class="luakyw">then</span> <span class="luacmt">-- Мы получили один параметр?</span>
  iAttr <span class="luasbl">=</span> <span class="mark">SysUtils.FileGetAttr</span><span class="luasbl">(</span>params<span class="luasbl">[</span><span class="luanum">1</span><span class="luasbl">])</span>
  <span class="luakyw">if</span> iAttr <span class="luasbl">&gt;</span> <span class="luanum">0</span> <span class="luakyw">then</span> <span class="luacmt">-- Получили значение атрибута?</span>
    <span class="luakyw">if</span> math<span class="luasbl">.</span><span class="luafct">floor</span><span class="luasbl">(</span>iAttr <span class="luasbl">/</span> <span class="luanum">0x00000010</span><span class="luasbl">)</span> <span class="luasbl">%</span> <span class="luanum">2</span> <span class="luasbl">~=</span> <span class="luanum">0</span> <span class="luakyw">then</span>
      <span class="luacmt">-- 0x00000010 присутствует? Тогда это каталог.</span>
      DC.ExecuteCommand<span class="luasbl">(</span><span class="luastr">"cm_NewTab"</span><span class="luasbl">)</span>
      DC.ExecuteCommand<span class="luasbl">(</span><span class="luastr">"cm_ChangeDir"</span><span class="luasbl">,</span> params<span class="luasbl">[</span><span class="luanum">1</span><span class="luasbl">])</span>
    <span class="luakyw">end</span>
  <span class="luakyw">end</span>
<span class="luakyw">end</span></pre>

        <p>В приведённом выше примере <var>params[1]</var> является первым параметром, переданным скрипту.</p>
        <p>При использовании внутренней команды <a href="cmds.html#cm_ExecuteScript">cm_ExecuteScript</a> это будет первый параметр, переданный после имени файла скрипта.</p>
        <p>Итак, в нашем примере мы можем создать на панели инструментов кнопку, как показано ниже:</p>
        <p class="figure"><img class="largeimage" title="Параметр с cm_ExecuteScript" alt="Параметр с cm_ExecuteScript" src="images/imgDC/luaimg3.png" width="560" height="290"></p>
        <p>В этом примере скрипту будет передан параметр <code>%"0%p</code>: имя выделенного в активной панели файла или папки, без кавычек.</p>
        <p class="navback"><a href="#topofpage">(наверх)</a></p>
      </div>

      <div>
        <h2><a name="examplefind">3.2.3. Пример использования FindFirst, FindNext и FindClose</a></h2>
        <p>В следующем примере мы просканируем содержимое каталога, переданного первым параметром, и сохраним полученные данные в текстовый файл с именем, переданным вторым параметром.</p>
        <p>Это даст нам хорошее представление об использовании <code>FindFirst</code>, <code>FindNext</code> и <code>FindClose</code>.</p>

        <pre>
<span class="luakyw">local</span> params <span class="luasbl">=</span> <span class="luasbl">{...}</span>

<span class="luakyw">if</span> <span class="luasbl">#</span>params <span class="luasbl">==</span> <span class="luanum">2</span> then <span class="luacmt">-- У нас есть два параметра?</span>
  <span class="luakyw">local</span> Result <span class="luasbl">=</span> <span class="luakyw">nil</span>
  <span class="luakyw">local</span> hOutputFile <span class="luasbl">=</span> <span class="luakyw">nil</span>

  hOutputFile <span class="luasbl">=</span> io<span class="luasbl">.</span>output<span class="luasbl">(</span>params<span class="luasbl">[</span><span class="luanum">2</span><span class="luasbl">])</span>

  <span class="luakyw">local</span> Handle<span class="luasbl">,</span> FindData <span class="luasbl">=</span> <span class="mark">SysUtils.FindFirst</span><span class="luasbl">(</span>params<span class="luasbl">[</span><span class="luanum">1</span><span class="luasbl">]</span> <span class="luasbl">..</span> <span class="luastr">"\\*"</span><span class="luasbl">)</span>
  <span class="luakyw">if</span> Handle <span class="luasbl">~=</span> <span class="luakyw">nil</span> <span class="luakyw">then</span>
    <span class="luakyw">repeat</span>
      io.<span class="luafct">write</span><span class="luasbl">(</span>FindData.Name <span class="luasbl">..</span> <span class="luastr">"\r"</span><span class="luasbl">)</span>
      io.<span class="luafct">write</span><span class="luasbl">(</span>FindData.Size <span class="luasbl">..</span> <span class="luastr">"\r"</span><span class="luasbl">)</span>
      io.<span class="luafct">write</span><span class="luasbl">(</span><span class="luastr">"---------------\r"</span><span class="luasbl">)</span>

      Result<span class="luasbl">,</span>FindData <span class="luasbl">=</span> <span class="mark">SysUtils.FindNext</span><span class="luasbl">(</span>Handle<span class="luasbl">)</span>
    <span class="luakyw">until</span> Result <span class="luasbl">==</span> <span class="luakyw">nil</span>

    <span class="mark">SysUtils.FindClose</span><span class="luasbl">(</span>Handle<span class="luasbl">)</span>
    io<span class="luasbl">.</span>close<span class="luasbl">(</span>hOutputFile<span class="luasbl">)</span>
  <span class="luakyw">end</span>
<span class="luakyw">end</span></pre>
        <p>В приведённом выше примере нам нужно передать скрипту два параметра:</p>
        <ol>
          <li><var>params[1]</var> - каталог, содержимое которого мы хотим получить</li>
          <li><var>params[2]</var> - имя файла для сохранения результата работы скрипта</li>
        </ol>
        <p>Настраиваем кнопку на панели инструментов с внутренней командой <a href="cmds.html#cm_ExecuteScript">cm_ExecuteScript</a> и передаём параметрами всё необходимое:</p>
        <p class="figure"><img class="largeimage" title="Параметр с cm_ExecuteScript" alt="Параметр с cm_ExecuteScript" src="images/imgDC/luaimg4.png" width="560" height="262"></p>
        <p>В этом примере скрипту в качестве первого параметра будет передано <code>%"0%Ds</code>: имя каталога активной панели, без кавычек.</p>
        <p class="navback"><a href="#topofpage">(наверх)</a></p>
      </div>

      <div>
        <h2><a name="libraryclip">3.3. Библиотека Clipboard</a></h2>
        <p>Double Commander предоставляет скриптам Lua библиотеку функций для работы с буфером обмена.</p>
        <table>
          <tr class="rowcategorytitle"><th colspan="2">Библиотека Clipboard</th></tr>
          <tr class="rowsubtitle"><th class="categorynamecolumn">Функция</th><th class="categorydesccolumn">Описание</th></tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">Clipbrd.Clear</div></td>
            <td class="hintcell">
              <p class="definition">Clipbrd.Clear()</p>
              <p>Очищает содержимое буфера обмена.</p>
            </td>
          </tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">Clipbrd.GetAsText</div></td>
            <td class="hintcell">
              <p class="definition">sVar = Clipbrd.GetAsText()</p>
              <p>Получает содержимое буфера обмена как строку <var>sVar</var>. Если буфер обмена не содержит текст, то функция вернёт пустую строку.</p>
            </td>
          </tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">Clipbrd.SetAsText</div></td>
            <td class="hintcell">
              <p class="definition">Clipbrd.SetAsText(sVar)</p>
              <p>Помещает в буфер обмена строку текста <var>sVar</var>.</p>
            </td>
          </tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">Clipbrd.SetAsHtml</div></td>
            <td class="hintcell">
              <p class="definition">Clipbrd.SetAsHtml(sHtml)</p>
              <p>Добавляет в буфер обмена текст <var>sHtml</var> в формате HTML (формат буфера обмена <code>CF_HTML</code>).</p>
              <p>Содержимое может быть вставлено в приложения, поддерживающие этот формат буфера обмена, такие как MS Word, LO Writer и другие.</p>
              <p>Правильным будет сохранять данные с помощью и <code>Clipbrd.SetAsText</code>, и <code>Clipbrd.SetAsHtml</code>: приложение будет использовать тот формат, который поддерживает.</p>
              <p>Например, у нас может быть следующее:</p>
              <ul>
                <li><code>Clipbrd.SetAsText("Добро пожаловать в Double Commander!")</code></li>
                <li><code>Clipbrd.SetAsHtml("Добро пожаловать в &lt;b&gt;Double Commander&lt;/b&gt;!")</code></li>
              </ul>
              <p>Если мы запустим Блокнот и попытаемся вставить текст из буфера обмена, то будет вставлен текст, скопированный с помощью <code>Clipbrd.SetAsText</code>. Но если мы перейдём к Microsoft Word, то будет вставлена строка с выделенным жирным шрифтом <b>Double Commander</b>, потому что Microsoft Word распознаёт и поддерживает этот формат буфера обмена.</p>
            </td>
          </tr>
        </table>
        <p class="navback"><a href="#topofpage">(наверх)</a></p>
      </div>

      <div>
        <h2><a name="exampleclip">3.3.1. Пример работы с буфером обмена</a></h2>
        <p>В следующем примере используются три функции, связанные с буфером обмена: <code>Clear</code>, <code>GetAsText</code> и <code>SetAsText</code>.</p>
        <p>Это относительно большой скрипт, но было бы неплохо собрать вместе несколько функций, с которыми мы познакомились ранее.</p>
        <p>Предполагается, что в нашей активной панели открыт каталог с большим количеством текстовых файлов.</p>
        <p>Также предполагается, что в настоящее время в буфере обмена одно слово и что скрипт в качестве единственного параметра получит текущий каталог активной панели.</p>
        <p>Скрипт будет сканировать папку, читать содержимое файлов, один за другим, и искать слово из буфера обмена.</p>
        <p>Затем имена файлов, которые содержат это словом, будут скопированы в буфер обмена.</p>
        <p>Далее скрипт вызовет внутреннюю команду <a href="cmds.html#cm_LoadSelectionFromClip">cm_LoadSelectionFromClip</a> и все эти файлы будут выделены.</p>
        <p>Кроме того, в конце вернём обратно в буфер обмена слово, которое мы искали.</p>
        <pre>
<span class="luakyw">local</span> params <span class="luasbl">=</span> <span class="luasbl">{...}</span>
<span class="luakyw">local</span> Result <span class="luasbl">=</span> <span class="luakyw">nil</span>
<span class="luakyw">local</span> iAttr
<span class="luakyw">local</span> bFound <span class="luasbl">=</span> false
<span class="luakyw">local</span> sCompleteFilename <span class="luasbl">=</span> <span class="luastr">""</span>
<span class="luakyw">local</span> hInputFile <span class="luasbl">=</span> <span class="luakyw">nil</span>
<span class="luakyw">local</span> sLine <span class="luasbl">=</span> <span class="luastr">""</span>
<span class="luakyw">local</span> iPosS
<span class="luakyw">local</span> iPosE
<span class="luakyw">local</span> sFileToSelect <span class="luasbl">=</span> <span class="luastr">""</span>
<span class="luakyw">local</span> sSearchString <span class="luasbl">=</span> <span class="luastr">""</span>

<span class="luakyw">if</span> <span class="luasbl">#</span>params <span class="luasbl">==</span> <span class="luanum">1</span> <span class="luakyw">then</span> <span class="luacmt">-- Мы получили наш параметр?</span>
  sSearchString <span class="luasbl">=</span> <span class="mark">Clipbrd.GetAsText</span><span class="luasbl">()</span> <span class="luacmt">-- Получаем выражение для поиска.</span>
  <span class="mark">Clipbrd.Clear</span><span class="luasbl">()</span> <span class="luacmt">-- Очищаем буфер обмена.</span>
  DC.ExecuteCommand<span class="luasbl">(</span><span class="luastr">"cm_MarkUnmarkAll"</span><span class="luasbl">)</span> <span class="luacmt">-- Убедимся, что ничего не выделено.</span>

  <span class="luacmt">-- Начинаем сканировать все файлы нашего каталога один за другим.</span>
  <span class="luakyw">local</span> Handle<span class="luasbl">,</span> FindData <span class="luasbl">=</span> SysUtils.FindFirst(params<span class="luasbl">[</span><span class="luanum">1</span><span class="luasbl">]</span> <span class="luasbl">..</span> <span class="luastr">"\\*"</span><span class="luasbl">)</span>
  <span class="luakyw">if</span> Handle <span class="luasbl">~=</span> <span class="luakyw">nil</span> <span class="luakyw">then</span>
    <span class="luakyw">repeat</span>
      sCompleteFilename <span class="luasbl">=</span> params<span class="luasbl">[</span><span class="luanum">1</span><span class="luasbl">]</span> <span class="luasbl">..</span> <span class="luastr">"\\"</span> <span class="luasbl">..</span> FindData<span class="luasbl">.</span>Name
      iAttr <span class="luasbl">=</span> SysUtils.FileGetAttr<span class="luasbl">(</span>sCompleteFilename<span class="luasbl">)</span>
      <span class="luakyw">if</span> iAttr <span class="luasbl">&gt;</span> <span class="luanum">0</span> <span class="luakyw">then</span> <span class="luacmt">-- Получили значение атрибута?</span>
        <span class="luacmt">-- Нам нужен файл, не каталог!</span>
        <span class="luakyw">if</span> math<span class="luasbl">.</span><span class="luafct">floor</span><span class="luasbl">(</span>iAttr <span class="luasbl">/</span> <span class="luanum">0x00000010</span><span class="luasbl">)</span> <span class="luasbl">%</span> <span class="luanum">2</span> <span class="luasbl">==</span> <span class="luanum">0</span> <span class="luakyw">then</span>

          <span class="luacmt">-- Начинаем читать файл построчно, до конца файла ИЛИ до совпадения.</span>
          hInputFile <span class="luasbl">=</span> io<span class="luasbl">.</span>open<span class="luasbl">(</span>sCompleteFilename<span class="luasbl">,</span> <span class="luastr">"r"</span><span class="luasbl">)</span>
          bFound <span class="luasbl">=</span> false

          <span class="luakyw">while</span> bFound <span class="luasbl">==</span> false <span class="luakyw">do</span>
            sLine <span class="luasbl">=</span> hInputFile<span class="luasbl">:</span><span class="luafct">read</span><span class="luasbl">()</span>
            <span class="luakyw">if</span> sLine <span class="luasbl">==</span> <span class="luakyw">nil</span> <span class="luakyw">then</span> <span class="luakyw">break</span> <span class="luakyw">end</span>
            iPosS<span class="luasbl">,</span> iPosE <span class="luasbl">=</span> string<span class="luasbl">.</span>find<span class="luasbl">(</span>sLine, sSearchString<span class="luasbl">)</span>
            <span class="luakyw">if</span> iPosS <span class="luasbl">~=</span> <span class="luakyw">nil</span> <span class="luakyw">then</span> bFound <span class="luasbl">=</span> true <span class="luakyw">end</span>
          <span class="luakyw">end</span>

          <span class="luakyw">if</span> bFound <span class="luasbl">==</span> true <span class="luakyw">then</span>
            sFileToSelect <span class="luasbl">=</span> sFileToSelect <span class="luasbl">..</span> FindData<span class="luasbl">.</span>Name <span class="luasbl">..</span> <span class="luastr">"\n"</span>
          <span class="luakyw">end</span>

          io<span class="luasbl">.</span>close<span class="luasbl">(</span>hInputFile<span class="luasbl">)</span>
        <span class="luakyw">end</span>
      <span class="luakyw">end</span>
      Result<span class="luasbl">,</span>FindData <span class="luasbl">=</span> SysUtils<span class="luasbl">.</span>FindNext<span class="luasbl">(</span>Handle<span class="luasbl">)</span>
    <span class="luakyw">until</span> Result <span class="luasbl">==</span> <span class="luakyw">nil</span>

    SysUtils<span class="luasbl">.</span>FindClose<span class="luasbl">(</span>Handle<span class="luasbl">)</span>
  <span class="luakyw">end</span>

  <span class="luacmt">-- Если что-то нашли, то выделяем!</span>
  <span class="luakyw">if</span> sFileToSelect <span class="luasbl">~=</span> <span class="luastr">""</span> <span class="luakyw">then</span>
    <span class="mark">Clipbrd.SetAsText</span><span class="luasbl">(</span>sFileToSelect<span class="luasbl">)</span>
    DC<span class="luasbl">.</span>ExecuteCommand<span class="luasbl">(</span><span class="luastr">"cm_LoadSelectionFromClip"</span><span class="luasbl">)</span>
  <span class="luakyw">end</span>

  <span class="mark">Clipbrd.SetAsText</span><span class="luasbl">(</span>sSearchString<span class="luasbl">)</span> <span class="luacmt">-- Восстанавливаем содержимое буфера обмена.</span>
<span class="luakyw">end</span></pre>
        <p class="navback"><a href="#topofpage">(наверх)</a></p>
      </div>

      <div>
        <h2><a name="librarydialogs">3.4. Библиотека Dialogs</a></h2>
        <p>Эта библиотека позволяет нашим скриптам взаимодействовать с пользователем, показывая сообщения, выдавая запросы и т.д.</p>
        <table>
          <tr class="rowcategorytitle"><th colspan="2">Библиотека Dialogs</th></tr>
          <tr class="rowsubtitle"><th class="categorynamecolumn">Функция</th><th class="categorydesccolumn">Описание</th></tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">Dialogs.MessageBox</div></td>
            <td class="hintcell">
              <p class="definition">iButton = Dialogs.MessageBox(sMessage, sTitle, iFlags)</p>
              <p>Показывает окно сообщения, функция вернёт нажатую пользователем кнопку.</p>
              <p>Описание:</p>
              <ul>
                <li><var>sMessage</var> : Сообщение окна.</li>
                <li><var>sTitle</var> : Текст в заголовке окна.</li>
                <li><var>iFlags</var> : Сумма констант, задающих отображаемые кнопки, стиль окна и кнопку по умолчанию. Смотрите ниже таблицы с <a href="#dlgbuts">кнопками</a>, <a href="#dlgstyle">стилями</a> и <a href="#dlgdefbut">кнопкой по умолчанию</a>.</li>
                <li><var>iButton</var> : Возвращаемое значение, указывающее нажатую кнопку (смотрите <a href="#msgreturn">эту таблицу</a>).</li>
              </ul>
            </td>
          </tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">Dialogs.InputQuery</div></td>
            <td class="hintcell">
              <p class="definition">bResult, sAnswer = Dialogs.InputQuery(sTitle, sMessage, bMask, sDefault)</p>
              <p>Показывает диалоговое окно с полем ввода текста.</p>
              <p>Описание:</p>
              <ul>
                <li><var>sTitle</var> : Текст в заголовке окна.</li>
                <li><var>sMessage</var> : Сообщение окна.</li>
                <li><var>bMask</var> : Логическое (булево) значение, если <code>true</code>, то вводимый текст будет скрываться "звёздочками".</li>
                <li><var>sDefault</var> : Текст, который будет отображаться в строке ввода при появлении окна.</li>
                <li><var>bResult</var> : Возвращаемое логическое (булево) значение, указывающее, ввёл ли что-то пользователь или нет.</li>
                <li><var>sAnswer</var> : Возвращаемая строка, если пользователь что-то ввёл, а затем нажал ОК.</li>
              </ul>
            </td>
          </tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">Dialogs.InputListBox</div></td>
            <td class="hintcell">
              <p class="definition">sItem = Dialogs.InputListBox(sTitle, sMessage, aItems, sDefault)</p>
              <p>Показывает диалоговое окно с возможностью выбора из списка элементов.</p>
              <p>Описание:</p>
              <ul>
                <li><var>sTitle</var> : Текст в заголовке окна.</li>
                <li><var>sMessage</var> : Сообщение окна.</li>
                <li><var>aItems</var> : Таблица Lua, каждый элемент таблицы должен быть строкой.</li>
                <li><var>sDefault</var> : Пункт списка, выделенный по умолчанию.</li>
                <li><var>sItem</var> : Возвращаемая строка с выбранным пунктом или <code>nil</code> в случае отмены.</li>
              </ul>
            </td>
          </tr>
        </table>
        <p class="navback"><a href="#topofpage">(наверх)</a></p>
      </div>

      <div>
        <h2><a name="dlgbuts">3.4.1. Кнопки Dialogs.MessageBox</a></h2>
        <p>Кнопки, отображаемые в окне <code>Dialogs.MessageBox</code>, задаются одним из следующих значений:</p>
        <table>
          <tr class="rowcategorytitle"><th colspan="2">Константы для кнопок в Dialogs.MessageBox</th></tr>
          <tr class="rowsubtitle"><th class="categorynamecolumn">Значение константы</th><th class="categorydesccolumn">Отображаемые кнопки, слева направо</th></tr>
          <tr>
            <td class="varcell"><div class="firstcolumnaleft">0x0000<br><small class="firstcolumnaleft">MB_OK</small></div></td>
            <td class="hintcell">
              <img class="largeimage" title="Кнопка OK" alt="Кнопка OK" src="images/imgDC/luaimg11.png" width="72" height="21">
            </td>
          </tr>
          <tr>
            <td class="varcell"><div class="firstcolumnaleft">0x0001<br><small class="firstcolumnaleft">MB_OKCANCEL</small></div></td>
            <td class="hintcell">
              <img class="largeimage" title="Кнопка OK" alt="Кнопка OK" src="images/imgDC/luaimg11.png" width="72" height="21">
              <img class="largeimage" title="Кнопка ОТМЕНА" alt="Кнопка ОТМЕНА" src="images/imgDC/luaimg12.png" width="72" height="21">
            </td>
          </tr>
          <tr>
            <td class="varcell"><div class="firstcolumnaleft">0x0002<br><small class="firstcolumnaleft">MB_ABORTRETRYIGNORE</small></div></td>
            <td class="hintcell">
              <img class="largeimage" title="Кнопка ПРЕРВАТЬ" alt="Кнопка ПРЕРВАТЬ" src="images/imgDC/luaimg15.png" width="66" height="21">
              <img class="largeimage" title="Кнопка ПОВТОР" alt="Кнопка ПОВТОР" src="images/imgDC/luaimg14.png" width="66" height="21">
              <img class="largeimage" title="Кнопка ПРОПУСТИТЬ" alt="Кнопка ПРОПУСТИТЬ" src="images/imgDC/luaimg13.png" width="66" height="21">
            </td>
          </tr>
          <tr>
            <td class="varcell"><div class="firstcolumnaleft">0x0003<br><small class="firstcolumnaleft">MB_YESNOCANCEL</small></div></td>
            <td class="hintcell">
              <img class="largeimage" title="Кнопка ДА" alt="Кнопка ДА" src="images/imgDC/luaimg16.png" width="72" height="21">
              <img class="largeimage" title="Кнопка НЕТ" alt="Кнопка НЕТ" src="images/imgDC/luaimg17.png" width="72" height="21">
              <img class="largeimage" title="Кнопка ОТМЕНА" alt="Кнопка ОТМЕНА" src="images/imgDC/luaimg12.png" width="72" height="21">
            </td>
          </tr>
          <tr>
            <td class="varcell"><div class="firstcolumnaleft">0x0004<br><small class="firstcolumnaleft">MB_YESNO</small></div></td>
            <td class="hintcell">
              <img class="largeimage" title="Кнопка ДА" alt="Кнопка ДА" src="images/imgDC/luaimg16.png" width="72" height="21">
              <img class="largeimage" title="Кнопка НЕТ" alt="Кнопка НЕТ" src="images/imgDC/luaimg17.png" width="72" height="21">
            </td>
          </tr>
          <tr>
            <td class="varcell"><div class="firstcolumnaleft">0x0005<br><small class="firstcolumnaleft">MB_RETRYCANCEL</small></div></td>
            <td class="hintcell">
              <img class="largeimage" title="Кнопка ПОВТОР" alt="Кнопка ПОВТОР" src="images/imgDC/luaimg14.png" width="66" height="21">
              <img class="largeimage" title="Кнопка ОТМЕНА" alt="Кнопка ОТМЕНА" src="images/imgDC/luaimg12.png" width="72" height="21">
            </td>
          </tr>
        </table>
        <p class="navback"><a href="#topofpage">(наверх)</a></p>
      </div>

      <div>
        <h2><a name="dlgstyle">3.4.2. Стиль окна Dialogs.MessageBox</a></h2>
        <p>Стиль окна <code>Dialogs.MessageBox</code> задаётся одним из следующих значений:</p>
        <table>
          <tr class="rowcategorytitle"><th colspan="2">Константы, задающие значок и стиль окна Dialogs.MessageBox</th></tr>
          <tr class="rowsubtitle"><th class="categorynamecolumn">Значение константы</th><th class="categorydesccolumn">Стиль окна</th></tr>
          <tr>
            <td class="varcell"><div class="firstcolumnaleft">0x0040<br><small class="firstcolumnaleft">MB_ICONINFORMATION</small></div></td>
            <td class="hintcell"><img class="largeimage" title="Значок ИНФОРМАЦИЯ" alt="Значок ИНФОРМАЦИЯ" src="images/imgDC/luaimg8.png" width="32" height="32"> Информационное окно</td>
          </tr>
          <tr>
            <td class="varcell"><div class="firstcolumnaleft">0x0030<br><small class="firstcolumnaleft">MB_ICONWARNING</small></div></td>
            <td class="hintcell"><img class="largeimage" title="Значок ПРЕДУПРЕЖДЕНИЕ" alt="Значок ПРЕДУПРЕЖДЕНИЕ" src="images/imgDC/luaimg9.png" width="32" height="32"> Окно предупреждения</td>
          </tr>
          <tr>
            <td class="varcell"><div class="firstcolumnaleft">0x0020<br><small class="firstcolumnaleft">MB_ICONQUESTION</small></div></td>
            <td class="hintcell"><img class="largeimage" title="Значок ВОПРОС" alt="Значок ВОПРОС" src="images/imgDC/luaimg7.png" width="32" height="32"> Окно подтверждения</td>
          </tr>
          <tr>
            <td class="varcell"><div class="firstcolumnaleft">0x0010<br><small class="firstcolumnaleft">MB_ICONERROR</small></div></td>
            <td class="hintcell"><img class="largeimage" title="Значок ОШИБКА" alt="Значок ОШИБКА" src="images/imgDC/luaimg10.png" width="32" height="32"> Окно ошибки</td>
          </tr>
        </table>
        <p class="navback"><a href="#topofpage">(наверх)</a></p>
      </div>

      <div>
        <h2><a name="dlgdefbut">3.4.3. Кнопка по умолчанию в Dialogs.MessageBox</a></h2>
        <p>Кнопка по умолчанию (активная) в <code>Dialogs.MessageBox</code> задаётся одним из следующих значений:</p>
        <table>
          <tr class="rowcategorytitle"><th colspan="2">Константы, задающие кнопку по умолчанию в Dialogs.MessageBox</th></tr>
          <tr class="rowsubtitle"><th class="categorynamecolumn">Значение константы</th><th class="categorydesccolumn">Кнопка по умолчанию</th></tr>
          <tr>
            <td class="varcell"><div class="firstcolumnaleft">0x0000<br><small class="firstcolumnaleft">MB_DEFBUTTON1</small></div></td>
            <td class="hintcell">Первая кнопка слева</td>
          </tr>
          <tr>
            <td class="varcell"><div class="firstcolumnaleft">0x0100<br><small class="firstcolumnaleft">MB_DEFBUTTON2</small></div></td>
            <td class="hintcell">Вторая кнопка слева</td>
          </tr>
          <tr>
            <td class="varcell"><div class="firstcolumnaleft">0x0200<br><small class="firstcolumnaleft">MB_DEFBUTTON3</small></div></td>
            <td class="hintcell">Третья кнопка слева</td>
          </tr>
        </table>
        <p class="navback"><a href="#topofpage">(наверх)</a></p>
      </div>

      <div>
        <h2><a name="msgreturn">3.4.4. Возвращаемое значение Dialogs.MessageBox</a></h2>
        <p>Число, возвращаемое функцией <code>Dialogs.MessageBox</code>, указывает на кнопку, которую нажал пользователь, и может быть одним из следующих:</p>
        <table>
          <tr class="rowcategorytitle"><th colspan="2">Возвращаемое значение Dialogs.MessageBox</th></tr>
          <tr class="rowsubtitle"><th class="categorynamecolumn">Значение константы</th><th class="categorydesccolumn">Нажатая кнопка</th></tr>
          <tr>
            <td class="varcell"><div class="firstcolumnaleft">0x0000<br><small class="firstcolumnaleft">mrNone</small></div></td>
            <td class="hintcell">Кнопка не нажата</td>
          </tr>
          <tr>
            <td class="varcell"><div class="firstcolumnaleft">0x0001<br><small class="firstcolumnaleft">mrOK</small></div></td>
            <td class="hintcell"><img class="largeimage" title="Результат: OK" alt="Результат: OK" src="images/imgDC/luaimg11.png" width="72" height="21"></td>
          </tr>
          <tr>
            <td class="varcell"><div class="firstcolumnaleft">0x0002<br><small class="firstcolumnaleft">mrCancel</small></div></td>
            <td class="hintcell"><img class="largeimage" title="Результат: ОТМЕНА" alt="Результат: ОТМЕНА" src="images/imgDC/luaimg12.png" width="72" height="21"></td>
          </tr>
          <tr>
            <td class="varcell"><div class="firstcolumnaleft">0x0003<br><small class="firstcolumnaleft">mrAbort</small></div></td>
            <td class="hintcell"><img class="largeimage" title="Результат: ПРЕРВАТЬ" alt="Результат: ПРЕРВАТЬ" src="images/imgDC/luaimg15.png" width="66" height="21"></td>
          </tr>
          <tr>
            <td class="varcell"><div class="firstcolumnaleft">0x0004<br><small class="firstcolumnaleft">mrRetry</small></div></td>
            <td class="hintcell"><img class="largeimage" title="Результат: ПОВТОР" alt="Результат: ПОВТОР" src="images/imgDC/luaimg14.png" width="66" height="21"></td>
          </tr>
          <tr>
            <td class="varcell"><div class="firstcolumnaleft">0x0005<br><small class="firstcolumnaleft">mrIgnore</small></div></td>
            <td class="hintcell"><img class="largeimage" title="Результат: ПРОПУСТИТЬ" alt="Результат: ПРОПУСТИТЬ" src="images/imgDC/luaimg13.png" width="66" height="21"></td>
          </tr>
          <tr>
            <td class="varcell"><div class="firstcolumnaleft">0x0006<br><small class="firstcolumnaleft">mrYes</small></div></td>
            <td class="hintcell"><img class="largeimage" title="Результат: ДА" alt="Результат: ДА" src="images/imgDC/luaimg16.png" width="72" height="21"></td>
          </tr>
          <tr>
            <td class="varcell"><div class="firstcolumnaleft">0x0007<br><small class="firstcolumnaleft">mrNo</small></div></td>
            <td class="hintcell"><img class="largeimage" title="Результат: НЕТ" alt="Результат: НЕТ" src="images/imgDC/luaimg17.png" width="72" height="21"></td>
          </tr>
        </table>
        <p>Примечание: Если закрыть окно, нажав крестик "x" в углу окна или клавишу <kbd>Esc</kbd>, то функция вернёт <code>0x0002</code>, как нажатие кнопки Отмена.</p>
        <p class="navback"><a href="#topofpage">(наверх)</a></p>
      </div>

      <div>
        <h2><a name="mesgboxsample">3.4.5. Пример использования Dialogs.MessageBox</a></h2>
        <p>Маленький скрипт, использующий <code>Dialogs.MessageBox</code>:</p>
        <pre>
<span class="luacmt">-- Отображаемые кнопки</span>
MB_OK <span class="luasbl">=</span> <span class="luanum">0x0000</span>
MB_OKCANCEL <span class="luasbl">=</span> <span class="luanum">0x0001</span>
MB_ABORTRETRYIGNORE <span class="luasbl">=</span> <span class="luanum">0x0002</span>
MB_YESNOCANCEL <span class="luasbl">=</span> <span class="luanum">0x0003</span>
MB_YESNO <span class="luasbl">=</span> <span class="luanum">0x0004</span>
MB_RETRYCANCEL <span class="luasbl">=</span> <span class="luanum">0x0005</span>

<span class="luacmt">-- Стиль окна</span>
MB_ICONINFORMATION <span class="luasbl">=</span> <span class="luanum">0x0040</span>
MB_ICONWARNING <span class="luasbl">=</span> <span class="luanum">0x0030</span>
MB_ICONQUESTION <span class="luasbl">=</span> <span class="luanum">0x0020</span>
MB_ICONERROR <span class="luasbl">=</span> <span class="luanum">0x0010</span>

<span class="luacmt">-- Кнопка по умолчанию</span>
MB_DEFBUTTON1 <span class="luasbl">=</span> <span class="luanum">0x0000</span>
MB_DEFBUTTON2 <span class="luasbl">=</span> <span class="luanum">0x0100</span>
MB_DEFBUTTON3 <span class="luasbl">=</span> <span class="luanum">0x0200</span>

<span class="luacmt">-- Возвращаемое значение</span>
mrNone <span class="luasbl">=</span> <span class="luanum">0x0000</span>
mrOK <span class="luasbl">=</span> <span class="luanum">0x0001</span>
mrCancel <span class="luasbl">=</span> <span class="luanum">0x0002</span>
mrAbort <span class="luasbl">=</span> <span class="luanum">0x0003</span>
mrRetry <span class="luasbl">=</span> <span class="luanum">0x0004</span>
mrIgnore <span class="luasbl">=</span> <span class="luanum">0x0005</span>
mrYes <span class="luasbl">=</span> <span class="luanum">0x0006</span>
mrNo <span class="luasbl">=</span> <span class="luanum">0x0007</span>

iFlags <span class="luasbl">=</span> MB_YESNO <span class="luasbl">+</span> MB_ICONQUESTION <span class="luasbl">+</span> MB_DEFBUTTON2
iButton <span class="luasbl">=</span> <span class="mark">Dialogs.MessageBox</span><span class="luasbl">(</span><span class="luastr">"Хотите завершить?"</span><span class="luasbl">,</span> <span class="luastr">"Вопрос"</span><span class="luasbl">,</span> iFlags<span class="luasbl">)</span>

<span class="luakyw">if</span> iButton <span class="luasbl">==</span> mrYes <span class="luakyw">then</span>
  DC<span class="luasbl">.</span>ExecuteCommand<span class="luasbl">(</span><span class="luastr">"cm_Exit"</span><span class="luasbl">)</span>
<span class="luakyw">end</span></pre>
        <p class="figure"><img class="largeimage" title="Пример использования Dialogs.MessageBox" alt="Пример использования Dialogs.MessageBox" src="images/imgDC/luaimg6.png" width="362" height="120"></p>
        <p class="navback"><a href="#topofpage">(наверх)</a></p>
      </div>

      <div>
        <h2><a name="querysample">3.4.6. Пример использования Dialogs.InputQuery</a></h2>
        <p>Маленький скрипт, использующий <code>Dialogs.InputQuery</code>:</p>
        <pre>
bResult<span class="luasbl">,</span> sAnswer <span class="luasbl">=</span> <span class="mark">Dialogs.InputQuery</span><span class="luasbl">(</span><span class="luastr">"Идентификация"</span><span class="luasbl">,</span> <span class="luastr">"Введите ваше имя:"</span><span class="luasbl">,</span> false<span class="luasbl">,</span> <span class="luastr">"Иван"</span><span class="luasbl">)</span>

<span class="luakyw">if</span> bResult <span class="luasbl">==</span> true then
  Dialogs<span class="luasbl">.</span>MessageBox<span class="luasbl">(</span><span class="luastr">"Привет, "</span> <span class="luasbl">..</span> sAnswer .. <span class="luastr">"!"</span><span class="luasbl">,</span> <span class="luastr">"Добро пожаловать!"</span><span class="luasbl">,</span> <span class="luanum">0x0040</span><span class="luasbl">)</span>
<span class="luakyw">end</span></pre>
        <p class="figure"><img class="largeimage" title="Пример использования Dialogs.InputQuery" alt="Пример использования Dialogs.InputQuery" src="images/imgDC/luaimg5.png" width="364" height="112"></p>
        <p class="navback"><a href="#topofpage">(наверх)</a></p>
      </div>

      <div>
        <h2><a name="libraryutf8">3.5. Библиотека UTF-8</a></h2>
        <p>Эта библиотека обеспечивает базовую поддержку кодировки UTF-8.</p>
        <p>Все функции представлены в таблице <code>LazUtf8</code>.</p>
        <table>
          <tr class="rowcategorytitle"><th colspan="2">Библиотека UTF-8</th></tr>
          <tr class="rowsubtitle"><th class="categorynamecolumn">Функция</th><th class="categorydesccolumn">Описание</th></tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">LazUtf8.Pos</div></td>
            <td class="hintcell">
              <p class="definition">iResult = LazUtf8.Pos(SearchText, SourceText, Offset)</p>
              <p>Поиск подстроки в строке, начиная с определённой позиции. Поиск чувствителен к регистру.</p>
              <p>Возвращает позицию первого вхождения подстроки <var>SearchText</var> в строке <var>SourceText</var>, поиск начинается с позиции <var>Offset</var> (по умолчанию 1).</p>
              <p>Если в <var>SourceText</var> не найдено совпадение с <var>SearchText</var> после заданного <var>Offset</var>, то функция возвращает ноль.</p>
            </td>
          </tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">LazUtf8.Next<span class="versionref"><sup>(Бета-версия)</sup></span></div></td>
            <td class="hintcell">
              <p class="definition">LazUtf8.Next(String)</p>
              <p>Функция-итератор, которая при каждом вызове возвращает следующий символ в строке <var>String</var> и позицию начала этого символа (в байтах).</p>
              <p>Пример:</p>
<pre>
<span class="luacmt">-- Выведем пары значений в виде "позиция : символ"</span>
<span class="luakyw">for</span> iPos, sChar <span class="luakyw">in</span> LazUtf8.Next<span class="luasbl">(</span>String<span class="luasbl">)</span> <span class="luakyw">do</span>
  DC.LogWrite<span class="luasbl">(</span>iPos .. <span class="luastr">" : "</span> .. sChar<span class="luasbl">)</span>
<span class="luakyw">end</span>
</pre>
            </td>
          </tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">LazUtf8.Copy</div></td>
            <td class="hintcell">
              <p class="definition">sResult = LazUtf8.Copy(String, iIndex, iCount)</p>
              <p>Копирует (извлекает) часть строки.</p>
              <p>Функция возвращает <var>iCount</var> символов из строки <var>String</var>, начиная с позиции <var>iIndex</var>.</p>
              <p>Если <var>iCount</var> больше длины строки <var>String</var>, то результат усекается. Если <var>iIndex</var> больше длины строки <var>String</var>, то возвращается пустая строка.</p>
            </td>
          </tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">LazUtf8.Length</div></td>
            <td class="hintcell">
              <p class="definition">iResult = LazUtf8.Length(String)</p>
              <p>Возвращает количество символов в строке с учётом кодировки UTF-8.</p>
            </td>
          </tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">LazUtf8.UpperCase</div></td>
            <td class="hintcell">
              <p class="definition">sResult = LazUtf8.UpperCase(String)</p>
              <p>Возвращает строку, в которой все буквы в нижнем регистре (строчные) заменены на буквы в верхнем регистре (прописные или заглавные).</p>
            </td>
          </tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">LazUtf8.LowerCase</div></td>
            <td class="hintcell">
              <p class="definition">sResult = LazUtf8.LowerCase(String)</p>
              <p>Возвращает строку, в которой все буквы в верхнем регистре (прописные или заглавные) заменены на буквы в нижнем регистре (строчные).</p>
            </td>
          </tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">LazUtf8.ConvertEncoding</div></td>
            <td class="hintcell">
              <p class="definition">sResult = LazUtf8.ConvertEncoding(String, FromEnc, ToEnc)</p>
              <p>Конвертирует кодировку <var>String</var> из <var>FromEnc</var> в <var>ToEnc</var>.</p>
              <p>Список поддерживаемых значений кодировок:</p>
              <ul>
                <li>Системная кодировка по умолчанию (зависит от языковых стандартов системы): "default".</li>
                <li>Кодировка ANSI (Windows) по умолчанию (зависит от языковых стандартов системы): "ansi".</li>
                <li>Кодировка OEM (DOS) по умолчанию (зависит от языковых стандартов системы): "oem".</li>
                <li>Юникод: "utf8", "utf8bom", "ucs2le", "ucs2be".</li>
                <li>ANSI (Windows): "cp1250", "cp1251", "cp1252", "cp1253", "cp1254", "cp1255", "cp1256", "cp1257", "cp1258".</li>
                <li>OEM (DOS): "cp437", "cp850", "cp852", "cp866", "cp874", "cp932", "cp936", "cp949", "cp950".</li>
                <li>ISO 8859: "iso88591", "iso88592", "iso885915".</li>
                <li>Другие: "macintosh", "koi8".</li>
              </ul>
              Специальные значения кодировок (примеры).
              <br><br>
              В Windows (английкий или русский языки):
              <ul>
              <li>"default" - cp1252 или cp1251</li>
              <li>"ansi" - cp1252 или cp1251</li>
              <li>"oem" - cp850 или cp866</li>
              </ul>
              В Linux (английкий или русский языки):
              <ul>
              <li>"default" - utf8</li>
              <li>"ansi" - cp1252 или cp1251</li>
              <li>"oem" - cp850 или cp866</li>
              </ul>
            </td>
          </tr>
        </table>
        <p class="navback"><a href="#topofpage">(наверх)</a></p>
      </div>

      <div>
        <h2><a name="librarychar">3.6. Библиотека Char</a><span class="versionref"><sup>(Бета-версия)</sup></span></h2>
        <p>Эта библиотека содержит функции для проверки принадлежности символа к определённой категории юникода, а также для получения категории символа.</p>
        <p>Список доступных функций:</p>
        <table>
          <tr class="rowcategorytitle"><th colspan="2">Библиотека Char</th></tr>
          <tr class="rowsubtitle"><th class="categorynamecolumn">Функция</th><th class="categorydesccolumn">Описание</th></tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">Char.GetUnicodeCategory</div></td>
            <td class="hintcell">
              <p class="definition">iResult = Char.GetUnicodeCategory(Character)</p>
              <p>Возвращает категорию юникода символа <code>Character</code>, одно из следующих значений:</p>
              <table class="innercmddesc">
                <tr class="rowinnerdesc"><th class="innerdescheader">Значение</th><th class="innerdescheader">Описание</th></tr>
                <tr><td colspan="2">&nbsp;&nbsp;Буква:</td></tr>
                <tr><td class="innerdescvaluecell">0</td><td class="innerdescdesccell">Буква в верхнем регистре (Lu)</td></tr>
                <tr><td class="innerdescvaluecell">1</td><td class="innerdescdesccell">Буква в нижнем регистре (Ll)</td></tr>
                <tr><td class="innerdescvaluecell">2</td><td class="innerdescdesccell">Заглавная буква (Lt)</td></tr>
                <tr><td class="innerdescvaluecell">3</td><td class="innerdescdesccell">Модификатор (Lm)</td></tr>
                <tr><td class="innerdescvaluecell">4</td><td class="innerdescdesccell">Прочие буквы (Lo)</td></tr>
                <tr><td colspan="2">&nbsp;&nbsp;Отметки:</td></tr>
                <tr><td class="innerdescvaluecell">5</td><td class="innerdescdesccell">Символ нулевой ширины, указывающий на изменение базового символа (Mn)</td></tr>
                <tr><td class="innerdescvaluecell">6</td><td class="innerdescdesccell">Символ ненулевой ширины, указывающий на изменение базового символа (Mc)</td></tr>
                <tr><td class="innerdescvaluecell">7</td><td class="innerdescdesccell">Вложенный символ (Me)</td></tr>
                <tr><td colspan="2">&nbsp;&nbsp;Цифра:</td></tr>
                <tr><td class="innerdescvaluecell">8</td><td class="innerdescdesccell">Десятичная цифра (Nd)</td></tr>
                <tr><td class="innerdescvaluecell">9</td><td class="innerdescdesccell">Цифра, обозначаемая буквами (Nl)</td></tr>
                <tr><td class="innerdescvaluecell">10</td><td class="innerdescdesccell">Прочие цифры (No)</td></tr>
                <tr><td colspan="2">&nbsp;&nbsp;Знак пунктуации:</td></tr>
                <tr><td class="innerdescvaluecell">11</td><td class="innerdescdesccell">Соединитель (Pc)</td></tr>
                <tr><td class="innerdescvaluecell">12</td><td class="innerdescdesccell">Тире (Pd)</td></tr>
                <tr><td class="innerdescvaluecell">13</td><td class="innerdescdesccell">Открывающий знак пунктуации (скобки) (Ps)</td></tr>
                <tr><td class="innerdescvaluecell">14</td><td class="innerdescdesccell">Закрывающий знак пунктуации (скобки) (Pe)</td></tr>
                <tr><td class="innerdescvaluecell">15</td><td class="innerdescdesccell">Знак открывающей кавычки (Pi)</td></tr>
                <tr><td class="innerdescvaluecell">16</td><td class="innerdescdesccell">Знак закрывающей кавычки (Pf)</td></tr>
                <tr><td class="innerdescvaluecell">17</td><td class="innerdescdesccell">Прочие знаки пунктуации (Po)</td></tr>
                <tr><td colspan="2">&nbsp;&nbsp;Символ:</td></tr>
                <tr><td class="innerdescvaluecell">18</td><td class="innerdescdesccell">Математический символ (Sm)</td></tr>
                <tr><td class="innerdescvaluecell">19</td><td class="innerdescdesccell">Денежная единица (Sc)</td></tr>
                <tr><td class="innerdescvaluecell">20</td><td class="innerdescdesccell">Модификатор (Sk)</td></tr>
                <tr><td class="innerdescvaluecell">21</td><td class="innerdescdesccell">Прочие символы (So)</td></tr>
                <tr><td colspan="2">&nbsp;&nbsp;Разделитель:</td></tr>
                <tr><td class="innerdescvaluecell">22</td><td class="innerdescdesccell">Пробел (Zs)</td></tr>
                <tr><td class="innerdescvaluecell">23</td><td class="innerdescdesccell">Разделитель строк (Zl)</td></tr>
                <tr><td class="innerdescvaluecell">24</td><td class="innerdescdesccell">Разделитель параграфов (Zp)</td></tr>
                <tr><td colspan="2">&nbsp;&nbsp;Прочее:</td></tr>
                <tr><td class="innerdescvaluecell">25</td><td class="innerdescdesccell">Управляющий символ (Cc)</td></tr>
                <tr><td class="innerdescvaluecell">26</td><td class="innerdescdesccell">Символ форматирования (Cf)</td></tr>
                <tr><td class="innerdescvaluecell">27</td><td class="innerdescdesccell">Символ-заместитель (суррогат) (Cs)</td></tr>
                <tr><td class="innerdescvaluecell">28</td><td class="innerdescdesccell">Для частного использования (Co)</td></tr>
                <tr><td class="innerdescvaluecell">29</td><td class="innerdescdesccell">Не определён (Cn)</td></tr>
              </table>
            </td>
          </tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">Char.IsDigit</div></td>
            <td class="hintcell">
              <p class="definition">bResult = Char.IsDigit(Character)</p>
              <p>Возвращает <code>true</code>, если символ <var>Character</var> входит в категорию <i>Nd</i>.</p>
            </td>
          </tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">Char.IsLetter</div></td>
            <td class="hintcell">
              <p class="definition">bResult = Char.IsLetter(Character)</p>
              <p>Возвращает <code>true</code>, если символ <var>Character</var> входит в категорию <i>Lu</i>, <i>Ll</i>, <i>Lt</i>, <i>Lm</i> или <i>Lo</i>.</p>
            </td>
          </tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">Char.IsLetterOrDigit</div></td>
            <td class="hintcell">
              <p class="definition">bResult = Char.IsLetterOrDigit(Character)</p>
              <p>Возвращает <code>true</code>, если символ <var>Character</var> входит в категорию <i>Lu</i>, <i>Ll</i>, <i>Lt</i>, <i>Lm</i> <i>Lo</i>, <i>Nd</i> или <i>Nl</i>.</p>
            </td>
          </tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">Char.IsLower</div></td>
            <td class="hintcell">
              <p class="definition">bResult = Char.IsLower(Character)</p>
              <p>Возвращает <code>true</code>, если символ <var>Character</var> входит в категорию <i>Ll</i>.</p>
            </td>
          </tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">Char.IsUpper</div></td>
            <td class="hintcell">
              <p class="definition">bResult = Char.IsUpper(Character)</p>
              <p>Возвращает <code>true</code>, если символ <var>Character</var> входит в категорию <i>Lu</i>.</p>
            </td>
          </tr>
        </table>
        <p>Также эти функции поддерживают работу с двумя параметрами: вместо одного символа мы можем указать строку и позицию символа в этой строке.</p>
        <p class="navback"><a href="#topofpage">(наверх)</a></p>
      </div>

      <div>
        <h2><a name="libraryos">3.7. Библиотека OS</a></h2>
        <p>Эта библиотека содержит функции, связанные с операционной системой, в которой запущен Double Commander.</p>
        <p>Список доступных функций:</p>
        <table>
          <tr class="rowcategorytitle"><th colspan="2">Библиотека OS</th></tr>
          <tr class="rowsubtitle"><th class="categorynamecolumn">Функция</th><th class="categorydesccolumn">Описание</th></tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">os.execute</div></td>
            <td class="hintcell">
              <p class="definition">iResultCode = os.execute(sCommand)</p>
              <p>Выполнить <var>sCommand</var>, аналогично введённой в командной строке, будет возвращён код завершения.</p>
              <p><var>sCommand</var> может быть:</p>
              <ul>
                <li>Команда терминала, например, <code>os.execute("dir &gt; all.txt")</code></li>
                <li>Исполняемый файл, например, <code>os.execute("C:\\Windows\\System32\\calc.exe")</code></li>
                <li>Исполняемый файл с параметрами:<br><code>os.execute("C:\\Utils\\fsum.exe -md5 test.bin &gt; md5.txt")</code></li>
              </ul>
            </td>
          </tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">os.tmpname</div></td>
            <td class="hintcell">
              <p class="definition">sTempFileName = os.tmpname()</p>
              <p>Возвращает строку с именем файла, который может быть использован в качестве временного файла (в системном каталоге для временных файлов).<br>Если функции не удалось создать уникальное имя, то она вернёт пустую строку.</p>
            </td>
          </tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">os.remove</div></td>
            <td class="hintcell">
              <p class="definition">bResult, sError, iError = os.remove(sFileName)</p>
              <p>Удалить файл с именем <var>sFileName</var>.</p>
              <p>Если удалось, функция вернёт <code>true</code>.</p>
              <p>Если не удалось, функция вернёт:</p>
              <ol>
                <li><code>nil</code> как индикатор неудачи</li>
                <li><var>sError</var> с описанием ошибки</li>
                <li><var>iError</var> в виде кода ошибки (число)</li>
              </ol>
            </td>
          </tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">os.rename</div></td>
            <td class="hintcell">
              <p class="definition">bResult, sError, iError = os.rename(sOldName, sNewName)</p>
              <p>Переименовать файл <var>sOldName</var> в <var>sNewName</var>.</p>
              <p><b><span class="uline">Примечание:</span> Если файл с именем <var>sNewName</var> уже существует, он будет заменён!</b></p>
              <p>Если удалось, функция вернёт <code>true</code>.</p>
              <p>Если не удалось, функция вернёт:</p>
              <ol>
                <li><code>nil</code> как индикатор неудачи</li>
                <li><var>sError</var> с описанием ошибки</li>
                <li><var>iError</var> в виде кода ошибки (число)</li>
              </ol>
            </td>
          </tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">os.getenv</div></td>
            <td class="hintcell">
              <p class="definition">Value = os.getenv(VariableName)</p>
              <p>Получить в <var>Value</var> значение переменной окружения <var>VariableName</var>.<br>Если переменная не существует, то функция вернёт <code>nil</code>.</p></td>
          </tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">os.setenv</div></td>
            <td class="hintcell">
              <p class="definition">os.setenv(VariableName, Value)</p>
              <p>Добавить или изменить переменную окружения <var>VariableName</var>. В случае ошибки функция возвращает -1.</p></td>
          </tr>
          <tr>
            <td class="cmdcell"><div class="firstcolumnaleft">os.unsetenv</div></td>
            <td class="hintcell">
              <p class="definition">os.unsetenv(VariableName)</p>
              <p>Удалить переменную окружения <var>VariableName</var>. В случае ошибки функция возвращает -1.</p></td>
          </tr>
        </table>
        <p class="navback"><a href="#topofpage">(наверх)</a></p>
        <br>
      </div>
    </div>
    <div class="footer"><div class="nav"><a title="Начало" href="index.html">Начало</a> | <a title="Предыдущая страница" href="regexp.html">Пред.</a> | <a title="Следующая страница" href="commandline.html">След.</a></div></div>
    <div class="checker">
      <a href="https://validator.w3.org/check?uri=referer" target="_blank"><img src="https://www.w3.org/Icons/valid-html40" alt="Valid HTML 4.0 Transitional" height="31" width="88"></a>
      <a href="https://jigsaw.w3.org/css-validator/check/referer" target="_blank"><img style="border:0;width:88px;height:31px" src="https://jigsaw.w3.org/css-validator/images/vcss" alt="CSS Valid!"></a>
    </div>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
  </body>
</html>
